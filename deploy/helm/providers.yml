---
!provider # MARK: internal_fdp
name: internal_fdp_dev
group: dedl
priority: 1
roles:
  - host
description: DestineE Data Lake Fresh Data Pool
url: https://hda.data.destination-earth.eu/
search: !plugin
  type: StacSearch
  api_endpoint: http://eo-catalogue-stac-api:8080/search
  need_auth: false
  pagination:
    max_items_per_page: 1000
products:
  GENERIC_PRODUCT_TYPE:
    productType: "{productType}"
  STAT.EUSTAT.DAT.GREENHOUSE_GAS_EMISSION_AGRICULTURE:
    productType: STAT.EUSTAT.DAT.GREENHOUSE_GAS_EMISSION_AGRICULTURE
  STAT.EUSTAT.DAT.POP_AGE_GROUP_SEX_NUTS3:
    productType: STAT.EUSTAT.DAT.POP_AGE_GROUP_SEX_NUTS3
  STAT.EUSTAT.DAT.POP_AGE_SEX_NUTS2:
    productType: STAT.EUSTAT.DAT.POP_AGE_SEX_NUTS2
  STAT.EUSTAT.DAT.POP_CHANGE_DEMO_BALANCE_CRUDE_RATES_NUTS3:
    productType: STAT.EUSTAT.DAT.POP_CHANGE_DEMO_BALANCE_CRUDE_RATES_NUTS3
  STAT.EUSTAT.DAT.SHARE_ENERGY_FROM_RENEWABLE:
    productType: STAT.EUSTAT.DAT.SHARE_ENERGY_FROM_RENEWABLE
  STAT.EUSTAT.DAT.AVAILABLE_BEDS_HOSPITALS_NUTS2:
    productType: STAT.EUSTAT.DAT.AVAILABLE_BEDS_HOSPITALS_NUTS2
  STAT.EUSTAT.DAT.BATHING_SITES_WATER_QUALITY:
    productType: STAT.EUSTAT.DAT.BATHING_SITES_WATER_QUALITY
  STAT.EUSTAT.DAT.POP_DENSITY_NUTS3:
    productType: STAT.EUSTAT.DAT.POP_DENSITY_NUTS3
  STAT.EUSTAT.DAT.SOIL_SEALING_INDEX:
    productType: STAT.EUSTAT.DAT.SOIL_SEALING_INDEX
  STAT.EUSTAT.DAT.SURFACE_TERRESTRIAL_PROTECTED_AREAS:
    productType: STAT.EUSTAT.DAT.SURFACE_TERRESTRIAL_PROTECTED_AREAS
  STAT.ICPDR.DAT.DANUBEHIS:
    productType: STAT.ICPDR.DAT.DANUBEHIS
  EO.AERIS.DAT.IAGOS:
    productType: EO.AERIS.DAT.IAGOS
  EO.GSW.DAT.CHANGE:
    productType: EO.GSW.DAT.CHANGE
  EO.GSW.DAT.EXTENT:
    productType: EO.GSW.DAT.EXTENT
  EO.GSW.DAT.OCCURRENCE:
    productType: EO.GSW.DAT.OCCURRENCE
  EO.GSW.DAT.RECURRENCE:
    productType: EO.GSW.DAT.RECURRENCE
  EO.GSW.DAT.SEASONALITY:
    productType: EO.GSW.DAT.SEASONALITY
  EO.GSW.DAT.TRANSITIONS:
    productType: EO.GSW.DAT.TRANSITIONS
  EO.HYDRO.DAT.HAND:
    productType: EO.HYDRO.DAT.HAND
  EO.ISIMIP.DAT.CLIMATE-FORCING_ISIMIP3b:
    productType: EO.ISIMIP.DAT.CLIMATE-FORCING_ISIMIP3b
  EO.ISIMIP.DAT.SOCIO-ECONOMIC-FORCING_ISIMIP3b:
    productType: EO.ISIMIP.DAT.SOCIO-ECONOMIC-FORCING_ISIMIP3b
download: !plugin
  type: AwsDownload
  requester_pays: false
  ssl_verify: false
auth: !plugin
  type: AwsAuth
  ssl_verify: false
---
!provider # MARK: internal_fdp
name: internal_fdp
group: dedl
priority: 2
roles:
  - host
description: DestineE Data Lake Fresh Data Pool
url: https://hda.data.destination-earth.eu/
search: !plugin
  type: StacSearch
  api_endpoint: https://internal-catalogue.central.data.destination-earth.eu/search
  pagination:
    max_items_per_page: 1000
products:
  GENERIC_PRODUCT_TYPE:
    productType: "{productType}"
  STAT.EUSTAT.DAT.GREENHOUSE_GAS_EMISSION_AGRICULTURE:
    productType: STAT.EUSTAT.DAT.GREENHOUSE_GAS_EMISSION_AGRICULTURE
  STAT.EUSTAT.DAT.POP_AGE_GROUP_SEX_NUTS3:
    productType: STAT.EUSTAT.DAT.POP_AGE_GROUP_SEX_NUTS3
  STAT.EUSTAT.DAT.POP_AGE_SEX_NUTS2:
    productType: STAT.EUSTAT.DAT.POP_AGE_SEX_NUTS2
  STAT.EUSTAT.DAT.POP_CHANGE_DEMO_BALANCE_CRUDE_RATES_NUTS3:
    productType: STAT.EUSTAT.DAT.POP_CHANGE_DEMO_BALANCE_CRUDE_RATES_NUTS3
  STAT.EUSTAT.DAT.SHARE_ENERGY_FROM_RENEWABLE:
    productType: STAT.EUSTAT.DAT.SHARE_ENERGY_FROM_RENEWABLE
  STAT.EUSTAT.DAT.AVAILABLE_BEDS_HOSPITALS_NUTS2:
    productType: STAT.EUSTAT.DAT.AVAILABLE_BEDS_HOSPITALS_NUTS2
  STAT.EUSTAT.DAT.BATHING_SITES_WATER_QUALITY:
    productType: STAT.EUSTAT.DAT.BATHING_SITES_WATER_QUALITY
  STAT.EUSTAT.DAT.POP_DENSITY_NUTS3:
    productType: STAT.EUSTAT.DAT.POP_DENSITY_NUTS3
  STAT.EUSTAT.DAT.SOIL_SEALING_INDEX:
    productType: STAT.EUSTAT.DAT.SOIL_SEALING_INDEX
  STAT.EUSTAT.DAT.SURFACE_TERRESTRIAL_PROTECTED_AREAS:
    productType: STAT.EUSTAT.DAT.SURFACE_TERRESTRIAL_PROTECTED_AREAS
  STAT.ICPDR.DAT.DANUBEHIS:
    productType: STAT.ICPDR.DAT.DANUBEHIS
  EO.AERIS.DAT.IAGOS:
    productType: EO.AERIS.DAT.IAGOS
  EO.GSW.DAT.CHANGE:
    productType: EO.GSW.DAT.CHANGE
  EO.GSW.DAT.EXTENT:
    productType: EO.GSW.DAT.EXTENT
  EO.GSW.DAT.OCCURRENCE:
    productType: EO.GSW.DAT.OCCURRENCE
  EO.GSW.DAT.RECURRENCE:
    productType: EO.GSW.DAT.RECURRENCE
  EO.GSW.DAT.SEASONALITY:
    productType: EO.GSW.DAT.SEASONALITY
  EO.GSW.DAT.TRANSITIONS:
    productType: EO.GSW.DAT.TRANSITIONS
  EO.HYDRO.DAT.HAND:
    productType: EO.HYDRO.DAT.HAND
download: !plugin
  type: AwsDownload
  requester_pays: false
  ssl_verify: false
  s3_endpoint: https://s3.central.data.destination-earth.eu
  bucket_path_level: 0
auth: !plugin
  type: AwsAuth
  ssl_verify: false
---
!provider # MARK: external_fdp
name: external_fdp
group: dedl
priority: 1
description: DestineE Data Lake Fresh Data Pool
roles:
  - host
url: https://creodias.eu/
search: !plugin
  type: CreodiasS3Search
  api_endpoint: "https://datahub.creodias.eu/odata/v1/Products"
  s3_endpoint: "https://eodata.cloudferro.com"
  need_auth: true
  timeout: 120
  ssl_verify: true
  dont_quote:
    - "["
    - "]"
    - "$"
    - "="
    - "&"
    - ":"
  pagination:
    next_page_url_tpl: "{url}?{search}&$top={items_per_page}&$skip={skip}&$expand=Attributes&$expand=Assets&$count=True"
    total_items_nb_key_path: '$."@odata.count"'
    max_items_per_page: 1_000
  sort:
    sort_by_default:
      - !!python/tuple [startTimeFromAscendingNode, ASC]
    sort_by_tpl: "&$orderby={sort_param} {sort_order}"
    sort_param_mapping:
      startTimeFromAscendingNode: ContentDate/Start
      completionTimeFromAscendingNode: ContentDate/End
      publicationDate: PublicationDate
      modificationDate: ModificationDate
    sort_order_mapping:
      ascending: asc
      descending: desc
    max_sort_params: 1
  results_entry: "value"
  free_text_search_operations:
    $filter:
      union: " or "
      wrapper: "{}"
      operations:
        and:
          - "Collection/Name eq '{collection}'"
          - "OData.CSC.Intersects(area=geography'{geometry#to_ewkt}')"
          - "Attributes/OData.CSC.StringAttribute/any(att:att/Name eq 'processingLevel' and att/OData.CSC.StringAttribute/Value eq '{processingLevel}')"
          - "Attributes/OData.CSC.StringAttribute/any(att:att/Name eq 'productType' and att/OData.CSC.StringAttribute/Value eq '{productType}')"
          - "Attributes/OData.CSC.StringAttribute/any(att:att/Name eq 'platformShortName' and att/OData.CSC.StringAttribute/Value eq '{platform}')"
          - "Attributes/OData.CSC.StringAttribute/any(att:att/Name eq 'platformSerialIdentifier' and att/OData.CSC.StringAttribute/Value eq '{platformSerialIdentifier}')"
          - "Attributes/OData.CSC.IntegerAttribute/any(att:att/Name eq 'spatialResolution' and att/OData.CSC.StringAttribute/Value eq '{resolution}')"
          - "Attributes/OData.CSC.StringAttribute/any(att:att/Name eq 'authority' and att/OData.CSC.StringAttribute/Value eq '{organisationName}')"
          - "Attributes/OData.CSC.IntegerAttribute/any(att:att/Name eq 'orbitNumber' and att/OData.CSC.StringAttribute/Value eq '{orbitNumber}')"
          - "Attributes/OData.CSC.StringAttribute/any(att:att/Name eq 'orbitDirection' and att/OData.CSC.StringAttribute/Value eq '{orbitDirection}')"
          - "Attributes/OData.CSC.DoubleAttribute/any(att:att/Name eq 'cloudCover' and att/OData.CSC.DoubleAttribute/Value le {cloudCover})"
          - "Attributes/OData.CSC.StringAttribute/any(att:att/Name eq 'operationalMode' and att/OData.CSC.StringAttribute/Value eq '{sensorMode}')"
          - "Attributes/OData.CSC.StringAttribute/any(att:att/Name eq 'polarisationChannels' and att/OData.CSC.StringAttribute/Value eq '{polarizationChannels}')"
          - "Attributes/OData.CSC.StringAttribute/any(att:att/Name eq 'tileId' and att/OData.CSC.StringAttribute/Value eq '{tileIdentifier}')"
          - "ContentDate/Start lt {completionTimeFromAscendingNode#to_iso_utc_datetime}"
          - "ContentDate/End gt {startTimeFromAscendingNode#to_iso_utc_datetime}"
          - contains(Name,'{id}')
  discover_metadata:
    auto_discovery: true
    metadata_pattern: "^(?!collection)[a-zA-Z0-9]+$"
    search_param:
      free_text_search_operations:
        $filter:
          operations:
            and:
              - "Attributes/OData.CSC.StringAttribute/any(att:att/Name eq '{metadata}' and att/OData.CSC.StringAttribute/Value eq '{{{metadata}}}')"
    metadata_path: "$.Attributes.*"
  discover_product_types:
    fetch_url: null
  per_product_metadata_query: false
  metadata_pre_mapping:
    metadata_path: "$.Attributes"
    metadata_path_id: "Name"
    metadata_path_value: "Value"
  metadata_mapping:
    # Opensearch resource identifier within the search engine context (in our case
    # within the context of the data provider)
    # Queryable parameters are set with null as 1st configuration list value to mark them as queryable,
    #   but `free_text_search_operations.$filter.operations.and` entries are then used instead.
    uid: "$.Id"
    # OpenSearch Parameters for Collection Search (Table 3)
    productType:
      - null
      - "$.Attributes.productType"
    platform:
      - null
      - "$.Attributes.platformShortName"
    platformSerialIdentifier:
      - null
      - "$.Attributes.platformSerialIdentifier"
    instrument:
      - null
      - "$.Attributes.instrumentShortName"
    processingLevel:
      - null
      - "$.Attributes.processingLevel"
    # INSPIRE obligated OpenSearch Parameters for Collection Search (Table 4)
    title: "$.Name"
    resolution:
      - null
      - "$.Attributes.spatialResolution"
    organisationName:
      - null
      - "$.Attributes.authority"
    publicationDate: "$.PublicationDate"
    # OpenSearch Parameters for Product Search (Table 5)
    orbitNumber:
      - null
      - "$.Attributes.orbitNumber"
    orbitDirection:
      - null
      - "$.Attributes.orbitDirection"
    cloudCover:
      - null
      - "$.Attributes.cloudCover"
    modificationDate: "$.ModificationDate"
    sensorMode:
      - null
      - "$.Attributes.operationalMode"
    # OpenSearch Parameters for Acquistion Parameters Search (Table 6)
    startTimeFromAscendingNode:
      - null
      - "$.ContentDate.Start"
    completionTimeFromAscendingNode:
      - null
      - "$.ContentDate.End"
    polarizationChannels:
      - null
      - "$.Attributes.polarisationChannels"
    # Custom parameters (not defined in the base document referenced above)
    id:
      - null
      - "{$.Name#remove_extension}"
    tileIdentifier:
      - null
      - "$.Attributes.tileId"
    # The geographic extent of the product
    geometry:
      - null
      - '{$.Footprint#from_ewkt}'
    # The url to download the product "as is" (literal or as a template to be completed either after the search result
    # is obtained from the provider or during the eodag download phase)
    downloadLink: '$.S3Path.`sub(/^(.*)$/, s3:/\\1)`'
    # storageStatus: must be one of ONLINE, STAGING, OFFLINE
    storageStatus: "{$.Online#get_group_name((?P<ONLINE>True)|(?P<OFFLINE>False))}"
    collection:
      - null
      - $.null
    quicklook: '$.Assets[?(@.Type="QUICKLOOK")].DownloadLink'
    thumbnail: '$.Assets[?(@.Type="QUICKLOOK")].DownloadLink'
download: !plugin
  type: CreodiasS3Download
  flatten_top_dirs: True
  s3_endpoint: "https://eodata.cloudferro.com"
  s3_bucket: "eodata"
  ssl_verify: true
auth: !plugin
  type: AwsAuth
  auth_error_code: 403
  ssl_verify: true
  matching_conf:
    s3_endpoint: 'https://eodata.cloudferro.com'
products:
  # S1
  S1_SAR_GRD:
    productType: GRD
    collection: SENTINEL-1
    metadata_mapping:
      cloudCover: "$.null"
  S1_SAR_SLC:
    productType: SLC
    collection: SENTINEL-1
    metadata_mapping:
      cloudCover: "$.null"
  # S2
  S2_MSI_L1C:
    collection: SENTINEL-2
    productType: S2MSI1C
  S2_MSI_L2A:
    collection: SENTINEL-2
    productType: S2MSI2A
  # S3 SRAL
  S3_SRA:
    productType: SR_1_SRA___
    collection: SENTINEL-3
    metadata_mapping:
      cloudCover: "$.null"
  S3_SRA_A:
    productType: SR_1_SRA_A_
    collection: SENTINEL-3
    metadata_mapping:
      cloudCover: "$.null"
  S3_SRA_BS:
    productType: SR_1_SRA_BS
    collection: SENTINEL-3
    metadata_mapping:
      cloudCover: "$.null"
  S3_LAN:
    productType: SR_2_LAN___
    collection: SENTINEL-3
    metadata_mapping:
      cloudCover: "$.null"
  S3_WAT:
    productType: SR_2_WAT___
    collection: SENTINEL-3
    metadata_mapping:
      cloudCover: "$.null"
  # S3 OLCI
  S3_EFR:
    productType: OL_1_EFR___
    collection: SENTINEL-3
  S3_ERR:
    productType: OL_1_ERR___
    collection: SENTINEL-3
  S3_OLCI_L2LRR:
    productType: OL_2_LRR___
    collection: SENTINEL-3
  S3_OLCI_L2LFR:
    productType: OL_2_LFR___
    collection: SENTINEL-3
  S3_OLCI_L2WRR:
    productType: OL_2_WRR___
    collection: SENTINEL-3
  S3_OLCI_L2WFR:
    productType: OL_2_WFR___
    collection: SENTINEL-3
  # S3 SLSTR
  S3_SLSTR_L1RBT:
    productType: SL_1_RBT___
    collection: SENTINEL-3
  S3_SLSTR_L2LST:
    productType: SL_2_LST___
    collection: SENTINEL-3
  S3_SLSTR_L2WST:
    productType: SL_2_WST___
    collection: SENTINEL-3
  S3_SLSTR_L2AOD:
    productType: SL_2_AOD___
    collection: SENTINEL-3
  S3_SLSTR_L2FRP:
    productType: SL_2_FRP___
    collection: SENTINEL-3
  # S5P
  S5P_L1B_IR_ALL:
    collection: SENTINEL-5P
    processingLevel: L1B
  S5P_L2_IR_ALL:
    collection: SENTINEL-5P
    processingLevel: L2
  # COP DEM
  COP_DEM_GLO30_DGED:
    productType: DGE_30
    collection: COP-DEM
    metadata_mapping:
      cloudCover: "$.null"
  COP_DEM_GLO30_DTED:
    productType: DTE_30
    collection: COP-DEM
    metadata_mapping:
      cloudCover: "$.null"
  COP_DEM_GLO90_DGED:
    productType: DGE_90
    collection: COP-DEM
    metadata_mapping:
      cloudCover: "$.null"
  COP_DEM_GLO90_DTED:
    productType: DTE_90
    collection: COP-DEM
    metadata_mapping:
      cloudCover: "$.null"
  GENERIC_PRODUCT_TYPE:
    productType: "{productType}"
    collection: "{collection}"
---
!provider # MARK: creodias
name: creodias
priority: 0
description: CloudFerro DIAS
roles:
  - host
url: https://creodias.eu/
search: !plugin
  type: CreodiasS3Search
  api_endpoint: "https://datahub.creodias.eu/odata/v1/Products"
  s3_endpoint: "https://eodata.cloudferro.com"
  need_auth: true
  timeout: 120
  ssl_verify: true
  dont_quote:
    - "["
    - "]"
    - "$"
    - "="
    - "&"
    - ":"
  pagination:
    next_page_url_tpl: "{url}?{search}&$top={items_per_page}&$skip={skip}&$expand=Attributes&$expand=Assets&$count=True"
    total_items_nb_key_path: '$."@odata.count"'
    max_items_per_page: 1_000
  sort:
    sort_by_default:
      - !!python/tuple [startTimeFromAscendingNode, ASC]
    sort_by_tpl: "&$orderby={sort_param} {sort_order}"
    sort_param_mapping:
      startTimeFromAscendingNode: ContentDate/Start
      completionTimeFromAscendingNode: ContentDate/End
      publicationDate: PublicationDate
      modificationDate: ModificationDate
    sort_order_mapping:
      ascending: asc
      descending: desc
    max_sort_params: 1
  results_entry: "value"
  free_text_search_operations:
    $filter:
      union: " or "
      wrapper: "{}"
      operations:
        and:
          - "Collection/Name eq '{collection}'"
          - "OData.CSC.Intersects(area=geography'{geometry#to_ewkt}')"
          - "Attributes/OData.CSC.StringAttribute/any(att:att/Name eq 'processingLevel' and att/OData.CSC.StringAttribute/Value eq '{processingLevel}')"
          - "Attributes/OData.CSC.StringAttribute/any(att:att/Name eq 'productType' and att/OData.CSC.StringAttribute/Value eq '{productType}')"
          - "Attributes/OData.CSC.StringAttribute/any(att:att/Name eq 'platformShortName' and att/OData.CSC.StringAttribute/Value eq '{platform}')"
          - "Attributes/OData.CSC.StringAttribute/any(att:att/Name eq 'platformSerialIdentifier' and att/OData.CSC.StringAttribute/Value eq '{platformSerialIdentifier}')"
          - "Attributes/OData.CSC.IntegerAttribute/any(att:att/Name eq 'spatialResolution' and att/OData.CSC.StringAttribute/Value eq '{resolution}')"
          - "Attributes/OData.CSC.StringAttribute/any(att:att/Name eq 'authority' and att/OData.CSC.StringAttribute/Value eq '{organisationName}')"
          - "Attributes/OData.CSC.IntegerAttribute/any(att:att/Name eq 'orbitNumber' and att/OData.CSC.StringAttribute/Value eq '{orbitNumber}')"
          - "Attributes/OData.CSC.StringAttribute/any(att:att/Name eq 'orbitDirection' and att/OData.CSC.StringAttribute/Value eq '{orbitDirection}')"
          - "Attributes/OData.CSC.DoubleAttribute/any(att:att/Name eq 'cloudCover' and att/OData.CSC.DoubleAttribute/Value le {cloudCover})"
          - "Attributes/OData.CSC.StringAttribute/any(att:att/Name eq 'operationalMode' and att/OData.CSC.StringAttribute/Value eq '{sensorMode}')"
          - "Attributes/OData.CSC.StringAttribute/any(att:att/Name eq 'polarisationChannels' and att/OData.CSC.StringAttribute/Value eq '{polarizationChannels}')"
          - "Attributes/OData.CSC.StringAttribute/any(att:att/Name eq 'tileId' and att/OData.CSC.StringAttribute/Value eq '{tileIdentifier}')"
          - "ContentDate/Start lt {completionTimeFromAscendingNode#to_iso_utc_datetime}"
          - "ContentDate/End gt {startTimeFromAscendingNode#to_iso_utc_datetime}"
          - contains(Name,'{id}')
  discover_metadata:
    auto_discovery: true
    metadata_pattern: "^(?!collection)[a-zA-Z0-9]+$"
    search_param:
      free_text_search_operations:
        $filter:
          operations:
            and:
              - "Attributes/OData.CSC.StringAttribute/any(att:att/Name eq '{metadata}' and att/OData.CSC.StringAttribute/Value eq '{{{metadata}}}')"
    metadata_path: "$.Attributes.*"
  discover_product_types:
    fetch_url: null
  per_product_metadata_query: false
  metadata_pre_mapping:
    metadata_path: "$.Attributes"
    metadata_path_id: "Name"
    metadata_path_value: "Value"
  metadata_mapping:
    # Opensearch resource identifier within the search engine context (in our case
    # within the context of the data provider)
    # Queryable parameters are set with null as 1st configuration list value to mark them as queryable,
    #   but `free_text_search_operations.$filter.operations.and` entries are then used instead.
    uid: "$.Id"
    # OpenSearch Parameters for Collection Search (Table 3)
    productType:
      - null
      - "$.Attributes.productType"
    platform:
      - null
      - "$.Attributes.platformShortName"
    platformSerialIdentifier:
      - null
      - "$.Attributes.platformSerialIdentifier"
    instrument:
      - null
      - "$.Attributes.instrumentShortName"
    processingLevel:
      - null
      - "$.Attributes.processingLevel"
    # INSPIRE obligated OpenSearch Parameters for Collection Search (Table 4)
    title: "$.Name"
    resolution:
      - null
      - "$.Attributes.spatialResolution"
    organisationName:
      - null
      - "$.Attributes.authority"
    publicationDate: "$.PublicationDate"
    # OpenSearch Parameters for Product Search (Table 5)
    orbitNumber:
      - null
      - "$.Attributes.orbitNumber"
    orbitDirection:
      - null
      - "$.Attributes.orbitDirection"
    cloudCover:
      - null
      - "$.Attributes.cloudCover"
    modificationDate: "$.ModificationDate"
    sensorMode:
      - null
      - "$.Attributes.operationalMode"
    # OpenSearch Parameters for Acquistion Parameters Search (Table 6)
    startTimeFromAscendingNode:
      - null
      - "$.ContentDate.Start"
    completionTimeFromAscendingNode:
      - null
      - "$.ContentDate.End"
    polarizationChannels:
      - null
      - "$.Attributes.polarisationChannels"
    # Custom parameters (not defined in the base document referenced above)
    id:
      - null
      - "{$.Name#remove_extension}"
    tileIdentifier:
      - null
      - "$.Attributes.tileId"
    # The geographic extent of the product
    geometry:
      - null
      - '{$.Footprint#from_ewkt}'
    # The url to download the product "as is" (literal or as a template to be completed either after the search result
    # is obtained from the provider or during the eodag download phase)
    downloadLink: '$.S3Path.`sub(/^(.*)$/, s3:/\\1)`'
    # storageStatus: must be one of ONLINE, STAGING, OFFLINE
    storageStatus: "{$.Online#get_group_name((?P<ONLINE>True)|(?P<OFFLINE>False))}"
    collection:
      - null
      - $.null
    quicklook: '$.Assets[?(@.Type="QUICKLOOK")].DownloadLink'
    thumbnail: '$.Assets[?(@.Type="QUICKLOOK")].DownloadLink'
download: !plugin
  type: CreodiasS3Download
  flatten_top_dirs: True
  s3_endpoint: "https://eodata.cloudferro.com"
  s3_bucket: "eodata"
  ssl_verify: true
auth: !plugin
  type: AwsAuth
  auth_error_code: 403
  ssl_verify: true
  matching_conf:
    s3_endpoint: 'https://eodata.cloudferro.com'
products:
  # S1
  S1_SAR_GRD:
    productType: GRD
    collection: SENTINEL-1
    metadata_mapping:
      cloudCover: "$.null"
  S1_SAR_SLC:
    productType: SLC
    collection: SENTINEL-1
    metadata_mapping:
      cloudCover: "$.null"
  # S2
  S2_MSI_L1C:
    collection: SENTINEL-2
    productType: S2MSI1C
  S2_MSI_L2A:
    collection: SENTINEL-2
    productType: S2MSI2A
  # S3 SRAL
  S3_SRA:
    productType: SR_1_SRA___
    collection: SENTINEL-3
    metadata_mapping:
      cloudCover: "$.null"
  S3_SRA_A:
    productType: SR_1_SRA_A_
    collection: SENTINEL-3
    metadata_mapping:
      cloudCover: "$.null"
  S3_SRA_BS:
    productType: SR_1_SRA_BS
    collection: SENTINEL-3
    metadata_mapping:
      cloudCover: "$.null"
  S3_LAN:
    productType: SR_2_LAN___
    collection: SENTINEL-3
    metadata_mapping:
      cloudCover: "$.null"
  S3_WAT:
    productType: SR_2_WAT___
    collection: SENTINEL-3
    metadata_mapping:
      cloudCover: "$.null"
  # S3 OLCI
  S3_EFR:
    productType: OL_1_EFR___
    collection: SENTINEL-3
  S3_ERR:
    productType: OL_1_ERR___
    collection: SENTINEL-3
  S3_OLCI_L2LRR:
    productType: OL_2_LRR___
    collection: SENTINEL-3
  S3_OLCI_L2LFR:
    productType: OL_2_LFR___
    collection: SENTINEL-3
  S3_OLCI_L2WRR:
    productType: OL_2_WRR___
    collection: SENTINEL-3
  S3_OLCI_L2WFR:
    productType: OL_2_WFR___
    collection: SENTINEL-3
  # S3 SLSTR
  S3_SLSTR_L1RBT:
    productType: SL_1_RBT___
    collection: SENTINEL-3
  S3_SLSTR_L2LST:
    productType: SL_2_LST___
    collection: SENTINEL-3
  S3_SLSTR_L2WST:
    productType: SL_2_WST___
    collection: SENTINEL-3
  S3_SLSTR_L2AOD:
    productType: SL_2_AOD___
    collection: SENTINEL-3
  S3_SLSTR_L2FRP:
    productType: SL_2_FRP___
    collection: SENTINEL-3
  # S5P
  S5P_L1B_IR_ALL:
    collection: SENTINEL-5P
    processingLevel: L1B
  S5P_L2_IR_ALL:
    collection: SENTINEL-5P
    processingLevel: L2
  # COP DEM
  COP_DEM_GLO30_DGED:
    productType: DGE_30
    collection: COP-DEM
    metadata_mapping:
      cloudCover: "$.null"
  COP_DEM_GLO30_DTED:
    productType: DTE_30
    collection: COP-DEM
    metadata_mapping:
      cloudCover: "$.null"
  COP_DEM_GLO90_DGED:
    productType: DGE_90
    collection: COP-DEM
    metadata_mapping:
      cloudCover: "$.null"
  COP_DEM_GLO90_DTED:
    productType: DTE_90
    collection: COP-DEM
    metadata_mapping:
      cloudCover: "$.null"
  GENERIC_PRODUCT_TYPE:
    productType: "{productType}"
    collection: "{collection}"
---
!provider # MARK: cop_cds
name: cop_cds
priority: 0
description: Copernicus Climate Data Store
roles:
  - host
url: https://cds.climate.copernicus.eu
# anchors to avoid duplications
anchor_day_month_year: &day_month_year
  completionTimeFromAscendingNode:
    - |
      {{
        "year": {_date#interval_to_datetime_dict}["year"],
        "month": {_date#interval_to_datetime_dict}["month"],
        "day": {_date#interval_to_datetime_dict}["day"]
      }}
    - "{$.completionTimeFromAscendingNode#to_iso_date}"
anchor_day_month_year_time: &day_month_year_time
  completionTimeFromAscendingNode:
    - |
      {{
        "year": {_date#interval_to_datetime_dict}["year"],
        "month": {_date#interval_to_datetime_dict}["month"],
        "day": {_date#interval_to_datetime_dict}["day"],
        "time": {startTimeFromAscendingNode#get_ecmwf_time}
      }}
    - "{$.completionTimeFromAscendingNode#to_iso_date}"
anchor_month_year: &month_year
  completionTimeFromAscendingNode:
    - |
      {{
        "year": {_date#interval_to_datetime_dict}["year"],
        "month": {_date#interval_to_datetime_dict}["month"]
      }}
    - "{$.completionTimeFromAscendingNode#to_iso_date}"
anchor_month_year_time: &month_year_time
  completionTimeFromAscendingNode:
    - |
      {{
        "year": {_date#interval_to_datetime_dict}["year"],
        "month": {_date#interval_to_datetime_dict}["month"],
        "time": {startTimeFromAscendingNode#get_ecmwf_time}
      }}
    - "{$.completionTimeFromAscendingNode#to_iso_date}"
auth: !plugin
  type: HTTPHeaderAuth
  matching_url: https://cds.climate.copernicus.eu
  ssl_verify: true
  headers:
    PRIVATE-TOKEN: "{apikey}"
download: !plugin
  type: HTTPDownload
  timeout: 30
  ssl_verify: true
  extract: false
  auth_error_code: 401
  order_enabled: true
  order_method: POST
  order_on_response:
    metadata_mapping:
      orderId: $.json.jobID
      orderStatusLink: https://cds.climate.copernicus.eu/api/retrieve/v1/jobs/{orderId}
      searchLink: https://cds.climate.copernicus.eu/api/retrieve/v1/jobs/{orderId}/results
  order_status:
    request:
      method: GET
    metadata_mapping:
      status: $.json.status
    error:
      status: failed
    success:
      status: successful
    on_success:
      need_search: true
      metadata_mapping:
        downloadLink: $.json.asset.value.href
  products:
    UERRA_EUROPE_SL:
      output_extension: .grib
    GLACIERS_DIST_RANDOLPH:
      output_extension: .zip
      extract: true
    SATELLITE_CARBON_DIOXIDE:
      output_extension: .zip
      extract: true
    SATELLITE_METHANE:
      output_extension: .zip
      extract: true
    SEASONAL_POSTPROCESSED_PL:
      output_extension: .grib
    SEASONAL_POSTPROCESSED_SL:
      output_extension: .grib
    SEASONAL_ORIGINAL_SL:
      output_extension: .grib
    SEASONAL_ORIGINAL_PL:
      output_extension: .grib
    SEASONAL_MONTHLY_PL:
      output_extension: .grib
    SEASONAL_MONTHLY_SL:
      output_extension: .grib
    SIS_HYDRO_MET_PROJ:
      output_extension: .zip
      extract: true
search: !plugin
  type: ECMWFSearch
  ssl_verify: true
  end_date_excluded: false
  dates_required: true
  remove_from_query:
    - dataset
    - date
  discover_queryables:
    fetch_url: null
    product_type_fetch_url: null
    constraints_url: https://cds.climate.copernicus.eu/api/catalogue/v1/collections/{ecmwf:dataset}/constraints.json
    form_url: https://cds.climate.copernicus.eu/api/catalogue/v1/collections/{ecmwf:dataset}/form.json
  metadata_mapping:
    productType: $.productType
    title: $.id
    startTimeFromAscendingNode: "{$.startTimeFromAscendingNode#to_iso_utc_datetime}"
    completionTimeFromAscendingNode:
      - date={startTimeFromAscendingNode#to_iso_date}/{completionTimeFromAscendingNode#to_iso_date}
      - "{$.completionTimeFromAscendingNode#to_iso_utc_datetime}"
    _date: "{startTimeFromAscendingNode#to_iso_date}/{completionTimeFromAscendingNode#to_iso_date}"
    id: $.id
    # The geographic extent of the product
    geometry:
      - '{{"area": {geometry#to_nwse_bounds}}}'
      - $.geometry
    defaultGeometry: POLYGON((180 -90, 180 90, -180 90, -180 -90, 180 -90))
    storageStatus: OFFLINE
    downloadLink: $.null
    qs: $.qs
    orderLink: 'https://cds.climate.copernicus.eu/api/retrieve/v1/processes/{ecmwf:dataset}/execution?{{"inputs": {qs#to_geojson}}}'
    # Copernicus CDS specific parameters
    # to_geojson is used to handle versions like 1_0 that would be otherwise evaluated to 10 by the metadata mapping formating
    "ecmwf:version":
      - version
      - '{$."ecmwf:version"#to_geojson}'
products:
  # See available Public Datasets in https://cds.climate.copernicus.eu/cdsapp#!/search?type=dataset
  ERA5_SL:
    "ecmwf:dataset": reanalysis-era5-single-levels
    "ecmwf:product_type": reanalysis
    "ecmwf:variable": 10m_u_component_of_wind
    "ecmwf:data_format": grib
    "ecmwf:download_format": zip
    metadata_mapping:
      <<: *day_month_year_time
  ERA5_PL:
    "ecmwf:dataset": reanalysis-era5-pressure-levels
    "ecmwf:product_type": reanalysis
    "ecmwf:variable": geopotential
    "ecmwf:data_format": grib
    "ecmwf:download_format": zip
    metadata_mapping:
      <<: *day_month_year_time
  ERA5_PL_MONTHLY:
    "ecmwf:dataset": reanalysis-era5-pressure-levels-monthly-means
    "ecmwf:product_type": monthly_averaged_reanalysis_by_hour_of_day
    "ecmwf:variable": divergence
    "ecmwf:pressure_level": "1"
    "ecmwf:data_format": grib
    "ecmwf:download_format": zip
    metadata_mapping:
      <<: *month_year_time
  ERA5_LAND:
    "ecmwf:dataset": reanalysis-era5-land
    "ecmwf:variable": 2m_dewpoint_temperature
    "ecmwf:data_format": grib
    "ecmwf:download_format": zip
    metadata_mapping:
      <<: *day_month_year_time
  ERA5_LAND_MONTHLY:
    "ecmwf:dataset": reanalysis-era5-land-monthly-means
    "ecmwf:product_type": monthly_averaged_reanalysis_by_hour_of_day
    "ecmwf:variable": 2m_dewpoint_temperature
    "ecmwf:data_format": grib
    "ecmwf:download_format": zip
    metadata_mapping:
      <<: *month_year_time
  ERA5_SL_MONTHLY:
    "ecmwf:dataset": reanalysis-era5-single-levels-monthly-means
    "ecmwf:product_type": monthly_averaged_reanalysis_by_hour_of_day
    "ecmwf:data_format": grib
    "ecmwf:download_format": zip
    metadata_mapping:
      <<: *month_year_time
  UERRA_EUROPE_SL:
    "ecmwf:dataset": reanalysis-uerra-europe-single-levels
    "ecmwf:origin": mescan_surfex
    "ecmwf:variable": 10m_wind_direction
    "ecmwf:time": 00:00
    "ecmwf:data_format": grib
    metadata_mapping:
      <<: *day_month_year
  GLACIERS_DIST_RANDOLPH:
    "ecmwf:dataset": insitu-glaciers-extent
    "ecmwf:variable": glacier_area
    "ecmwf:product_type": gridded
    "ecmwf:version": rgi_6_0
    "ecmwf:data_format": zip
  GRIDDED_GLACIERS_MASS_CHANGE:
    "ecmwf:dataset": derived-gridded-glacier-mass-change
    "ecmwf:variable": glacier_mass_change
    "ecmwf:product_version": wgms_fog_2023_09
    "ecmwf:data_format": zip
    metadata_mapping:
      completionTimeFromAscendingNode:
        - |
          {{
            "hydrological_year": {completionTimeFromAscendingNode#get_hydrological_year}
          }}
        - "{$.completionTimeFromAscendingNode#get_hydrological_year}"
  SATELLITE_CARBON_DIOXIDE:
    "ecmwf:dataset": satellite-carbon-dioxide
    "ecmwf:processing_level": level_2
    "ecmwf:variable": xco2
    "ecmwf:sensor_and_algorithm": sciamachy_wfmd
    "ecmwf:version": '"4_0"'
    metadata_mapping:
      <<: *day_month_year
  SATELLITE_METHANE:
    "ecmwf:dataset": satellite-methane
    "ecmwf:processing_level": level_2
    "ecmwf:variable": xch4
    "ecmwf:sensor_and_algorithm": sciamachy_wfmd
    "ecmwf:version": '"4_0"'
    metadata_mapping:
      <<: *day_month_year
  SATELLITE_SEA_ICE_EDGE_TYPE:
    "ecmwf:dataset": satellite-sea-ice-edge-type
    "ecmwf:cdr_type": cdr
    "ecmwf:region": northern_hemisphere
    "ecmwf:variable":
      - sea_ice_edge
      - sea_ice_type
    "ecmwf:version": '"3_0"'
    metadata_mapping:
      <<: *day_month_year
  SATELLITE_SEA_ICE_THICKNESS:
    "ecmwf:dataset": satellite-sea-ice-thickness
    "ecmwf:cdr_type": cdr
    "ecmwf:satellite": envisat
    "ecmwf:variable": all
    "ecmwf:version": '"3_0"'
    metadata_mapping:
      <<: *month_year
  SATELLITE_SEA_ICE_CONCENTRATION:
    "ecmwf:dataset": satellite-sea-ice-concentration
    "ecmwf:cdr_type": cdr
    "ecmwf:origin": eumetsat_osi_saf
    "ecmwf:region":
      - northern_hemisphere
      - southern_hemisphere
    "ecmwf:sensor": ssmis
    "ecmwf:temporal_aggregation": daily
    "ecmwf:variable": all
    "ecmwf:version": v3
    metadata_mapping:
      <<: *day_month_year
  SATELLITE_SEA_LEVEL_GLOBAL:
    "ecmwf:dataset": satellite-sea-level-global
    "ecmwf:variable":
      - daily
    "ecmwf:version": vdt2021
    metadata_mapping:
      <<: *day_month_year
  SEASONAL_POSTPROCESSED_PL:
    "ecmwf:dataset": seasonal-postprocessed-pressure-levels
    "ecmwf:data_format": grib
    "ecmwf:originating_centre": ecmwf
    "ecmwf:system": "5"
    "ecmwf:variable": geopotential_anomaly
    "ecmwf:pressure_level": "10"
    "ecmwf:product_type": ensemble_mean
    "ecmwf:leadtime_month": "1"
    metadata_mapping:
      <<: *month_year
  SEASONAL_POSTPROCESSED_SL:
    "ecmwf:dataset": seasonal-postprocessed-single-levels
    "ecmwf:data_format": grib
    "ecmwf:originating_centre": ecmwf
    "ecmwf:system": "5"
    "ecmwf:variable": 2m_dewpoint_temperature_anomaly
    "ecmwf:product_type": ensemble_mean
    "ecmwf:leadtime_month": "1"
    metadata_mapping:
      <<: *month_year
  SEASONAL_ORIGINAL_SL:
    "ecmwf:dataset": seasonal-original-single-levels
    "ecmwf:data_format": grib
    "ecmwf:originating_centre": ecmwf
    "ecmwf:system": "5"
    "ecmwf:variable": 10m_u_component_of_wind
    "ecmwf:leadtime_hour": "6"
    "ecmwf:day": "01"
    metadata_mapping:
      <<: *month_year
  SEASONAL_ORIGINAL_PL:
    "ecmwf:dataset": seasonal-original-pressure-levels
    "ecmwf:data_format": grib
    "ecmwf:originating_centre": ecmwf
    "ecmwf:system": "5"
    "ecmwf:variable": geopotential
    "ecmwf:pressure_level": "10"
    "ecmwf:leadtime_hour": "12"
    "ecmwf:day": "01"
    metadata_mapping:
      <<: *month_year
  SEASONAL_MONTHLY_PL:
    "ecmwf:dataset": seasonal-monthly-pressure-levels
    "ecmwf:data_format": grib
    "ecmwf:originating_centre": ecmwf
    "ecmwf:system": "5"
    "ecmwf:variable": geopotential
    "ecmwf:pressure_level": "10"
    "ecmwf:product_type": monthly_mean
    "ecmwf:leadtime_month": "1"
    metadata_mapping:
      <<: *month_year
  SEASONAL_MONTHLY_SL:
    "ecmwf:dataset": seasonal-monthly-single-levels
    "ecmwf:data_format": grib
    "ecmwf:originating_centre": ecmwf
    "ecmwf:system": "5"
    "ecmwf:variable": 10m_u_component_of_wind
    "ecmwf:product_type": monthly_mean
    "ecmwf:leadtime_month": "1"
    metadata_mapping:
      <<: *month_year
  SIS_HYDRO_MET_PROJ:
    "ecmwf:dataset": sis-hydrology-meteorology-derived-projections
    "ecmwf:data_format": zip
    "ecmwf:product_type": climate_impact_indicators
    "ecmwf:variable": 2m_air_temperature
    "ecmwf:variable_type": absolute_change_from_reference_period
    "ecmwf:processing_type": original
    "ecmwf:time_aggregation": monthly_mean
    "ecmwf:horizontal_resolution": 5_km
    "ecmwf:experiment": degree_scenario
    "ecmwf:rcm": cclm4_8_17
    "ecmwf:gcm": ec_earth
    "ecmwf:ensemble_member": r12i1p1
    "ecmwf:period": 1_5_c
  GENERIC_PRODUCT_TYPE:
    "ecmwf:dataset": "{productType}"
---
!provider # MARK: cop_ads
name: cop_ads
priority: 0
description: Copernicus Atmosphere Data Store
roles:
  - host
url: https://ads.atmosphere.copernicus.eu/
anchor_month_year: &month_year
  completionTimeFromAscendingNode:
    - |
      {{
        "year": {_date#interval_to_datetime_dict}["year"],
        "month": {_date#interval_to_datetime_dict}["month"]
      }}
    - "{$.completionTimeFromAscendingNode#to_iso_date}"
auth: !plugin
  type: HTTPHeaderAuth
  matching_url: https://ads.atmosphere.copernicus.eu
  ssl_verify: true
  headers:
    PRIVATE-TOKEN: "{apikey}"
download: !plugin
  type: HTTPDownload
  timeout: 30
  ssl_verify: true
  extract: false
  auth_error_code: 401
  order_enabled: true
  order_method: POST
  order_on_response:
    metadata_mapping:
      orderId: $.json.jobID
      orderStatusLink: https://ads.atmosphere.copernicus.eu/api/retrieve/v1/jobs/{orderId}
      searchLink: https://ads.atmosphere.copernicus.eu/api/retrieve/v1/jobs/{orderId}/results
  order_status:
    request:
      method: GET
    metadata_mapping:
      status: $.json.status
    error:
      status: failed
    success:
      status: successful
    on_success:
      need_search: true
      metadata_mapping:
        downloadLink: $.json.asset.value.href
  products:
    CAMS_GAC_FORECAST:
      output_extension: .grib
    CAMS_GFE_GFAS:
      output_extension: .grib
    CAMS_EU_AIR_QUALITY_FORECAST:
      output_extension: .grib
    CAMS_EU_AIR_QUALITY_RE:
      output_extension: .zip
      extract: true
    CAMS_GRF:
      output_extension: .zip
      extract: true
    CAMS_GRF_AUX:
      output_extension: .zip
      extract: true
    CAMS_SOLAR_RADIATION:
      output_extension: .csv
    CAMS_GREENHOUSE_EGG4_MONTHLY:
      output_extension: .grib
    CAMS_GREENHOUSE_EGG4:
      output_extension: .grib
    CAMS_GREENHOUSE_INVERSION:
      output_extension: .grib
    CAMS_GLOBAL_EMISSIONS:
      output_extension: .zip
      extract: true
    CAMS_EAC4:
      output_extension: .grib
    CAMS_EAC4_MONTHLY:
      output_extension: .grib
search: !plugin
  type: ECMWFSearch
  ssl_verify: true
  end_date_excluded: false
  dates_required: true
  remove_from_query:
    - dataset
  discover_queryables:
    fetch_url: null
    product_type_fetch_url: null
    constraints_url: "https://ads.atmosphere.copernicus.eu/api/catalogue/v1/collections/{ecmwf:dataset}/constraints.json"
    form_url: https://ads.atmosphere.copernicus.eu/api/catalogue/v1/collections/{ecmwf:dataset}/form.json
  metadata_mapping:
    productType: "$.productType"
    title: "$.id"
    startTimeFromAscendingNode: "{$.startTimeFromAscendingNode#to_iso_date}"
    completionTimeFromAscendingNode:
      - "date={startTimeFromAscendingNode#to_iso_date}/{completionTimeFromAscendingNode#to_iso_date}"
      - "{$.completionTimeFromAscendingNode#to_iso_date}"
    _date: "{startTimeFromAscendingNode}/{completionTimeFromAscendingNode}"
    id: "$.id"
    # The geographic extent of the product
    geometry:
      - '{{"area": {geometry#to_nwse_bounds}}}'
      - "$.geometry"
    defaultGeometry: "POLYGON((180 -90, 180 90, -180 90, -180 -90, 180 -90))"
    storageStatus: OFFLINE
    downloadLink: "$.null"
    qs: $.qs
    orderLink: 'https://ads.atmosphere.copernicus.eu/api/retrieve/v1/processes/{ecmwf:dataset}/execution?{{"inputs": {qs#to_geojson}}}'
products:
  # See available Public Datasets in https://ads.atmosphere.copernicus.eu/cdsapp#!/search?type=dataset
  CAMS_GAC_FORECAST:
    "ecmwf:dataset": cams-global-atmospheric-composition-forecasts
    "ecmwf:type": forecast
    "ecmwf:data_format": grib
    "ecmwf:variable": 10m_u_component_of_wind
    "ecmwf:time": "00:00"
    "ecmwf:leadtime_hour": "0"
  CAMS_GFE_GFAS:
    "ecmwf:dataset": cams-global-fire-emissions-gfas
    "ecmwf:data_format": grib
    "ecmwf:variable": wildfire_combustion_rate
  CAMS_EU_AIR_QUALITY_FORECAST:
    "ecmwf:dataset": cams-europe-air-quality-forecasts
    "ecmwf:model": ensemble
    "ecmwf:data_format": grib
    "ecmwf:variable": ammonia
    "ecmwf:type": forecast
    "ecmwf:time": "00:00"
    "ecmwf:level": "0"
    "ecmwf:leadtime_hour": "0"
  CAMS_EU_AIR_QUALITY_RE:
    "ecmwf:dataset": cams-europe-air-quality-reanalyses
    "ecmwf:type": validated_reanalysis
    "ecmwf:data_format": zip
    "ecmwf:variable": nitrogen_dioxide
    "ecmwf:model": ensemble
    "ecmwf:level": "0"
    metadata_mapping:
      <<: *month_year
  CAMS_GRF:
    "ecmwf:dataset": cams-global-radiative-forcings
    "ecmwf:data_format": zip
    "ecmwf:variable": radiative_forcing_of_carbon_dioxide
    "ecmwf:forcing_type": instantaneous
    "ecmwf:band": long_wave
    "ecmwf:sky_type": all_sky
    "ecmwf:level": surface
    "ecmwf:version": "2"
    metadata_mapping:
      <<: *month_year
  CAMS_GRF_AUX:
    "ecmwf:dataset": cams-global-radiative-forcing-auxilliary-variables
    "ecmwf:band": short_wave
    "ecmwf:sky_type": clear_sky
    "ecmwf:version": "1.5"
    "ecmwf:data_format": zip
    "ecmwf:variable": aerosol_radiation_effect
    "ecmwf:aerosol_type": marine
    "ecmwf:level": surface
    metadata_mapping:
      <<: *month_year
  CAMS_SOLAR_RADIATION:
    "ecmwf:dataset": cams-solar-radiation-timeseries
    "ecmwf:sky_type": clear
    "ecmwf:time_step": 1minute
    "ecmwf:time_reference": true_solar_time
    "ecmwf:location":
      "latitude": 0
      "longitude": 0
    "ecmwf:altitude": -999
    "ecmwf:format": csv
    metadata_mapping:
      "ecmwf:latitude":
        - '{{"location": {{"latitude": {"ecmwf:latitude"}, "longitude": {"ecmwf:longitude"}}}}}'
        - '$."ecmwf:latitude"'
      "ecmwf:longitude":
        - '{{"location": {{"latitude": {"ecmwf:latitude"}, "longitude": {"ecmwf:longitude"}}}}}'
        - '$."ecmwf:longitude"'
  CAMS_GREENHOUSE_EGG4_MONTHLY:
    "ecmwf:dataset": cams-global-ghg-reanalysis-egg4-monthly
    "ecmwf:data_format": grib
    "ecmwf:variable": snow_albedo
    "ecmwf:product_type": monthly_mean
    metadata_mapping:
      <<: *month_year
  CAMS_GREENHOUSE_EGG4:
    "ecmwf:dataset": cams-global-ghg-reanalysis-egg4
    "ecmwf:data_format": grib
    "ecmwf:variable": snow_albedo
    "ecmwf:step": "0"
  CAMS_GREENHOUSE_INVERSION:
    "ecmwf:dataset": cams-global-greenhouse-gas-inversion
    "ecmwf:version": latest
    "ecmwf:variable": carbon_dioxide
    "ecmwf:quantity": mean_column
    "ecmwf:input_observations": surface
    "ecmwf:time_aggregation": instantaneous
    metadata_mapping:
      <<: *month_year
  CAMS_GLOBAL_EMISSIONS:
    "ecmwf:dataset": cams-global-emission-inventories
    "ecmwf:version": latest
    "ecmwf:data_format": zip
    "ecmwf:variable": acids
    "ecmwf:source": anthropogenic
    metadata_mapping:
      completionTimeFromAscendingNode:
        - |
          {{
            "year": {_date#interval_to_datetime_dict}["year"]
          }}
        - "{$.completionTimeFromAscendingNode#to_iso_date}"
  CAMS_EAC4:
    "ecmwf:dataset": cams-global-reanalysis-eac4
    "ecmwf:data_format": grib
    "ecmwf:variable": "2m_dewpoint_temperature"
    "ecmwf:time": "00:00"
  CAMS_EAC4_MONTHLY:
    "ecmwf:dataset": cams-global-reanalysis-eac4-monthly
    "ecmwf:data_format": grib
    "ecmwf:variable": 2m_dewpoint_temperature
    "ecmwf:product_type": monthly_mean
    metadata_mapping:
      <<: *month_year
  GENERIC_PRODUCT_TYPE:
    "ecmwf:dataset": "{productType}"
---
!provider # MARK: cop_ewds
name: cop_ewds
priority: 0
description: CEMS Early Warning Data Store
roles:
  - host
url: https://ewds.climate.copernicus.eu
anchor_time_day_month_year: &time_day_month_year
  completionTimeFromAscendingNode:
    - |
      {{
        "year": {_date#interval_to_datetime_dict}["year"],
        "month": {_date#interval_to_datetime_dict}["month"],
        "day": {_date#interval_to_datetime_dict}["day"],
        "time": {startTimeFromAscendingNode#get_ecmwf_time}
      }}
    - "{$.completionTimeFromAscendingNode#to_iso_date}"
anchor_day_month_year: &day_month_year
  completionTimeFromAscendingNode:
    - |
      {{
        "year": {_date#interval_to_datetime_dict}["year"],
        "month": {_date#interval_to_datetime_dict}["month"],
        "day": {_date#interval_to_datetime_dict}["day"]
      }}
    - "{$.completionTimeFromAscendingNode#to_iso_date}"
anchor_month_year: &month_year
  completionTimeFromAscendingNode:
    - |
      {{
        "year": {_date#interval_to_datetime_dict}["year"],
        "month": {_date#interval_to_datetime_dict}["month"]
      }}
    - "{$.completionTimeFromAscendingNode#to_iso_date}"
anchor_time_hday_hmonth_hyear: &time_hday_hmonth_hyear
  completionTimeFromAscendingNode:
    - |
      {{
        "hyear": {_date#interval_to_datetime_dict}["year"],
        "hmonth": {_date#interval_to_datetime_dict}["month"],
        "hday": {_date#interval_to_datetime_dict}["day"],
        "time": {startTimeFromAscendingNode#get_ecmwf_time}
      }}
    - "{$.completionTimeFromAscendingNode#to_iso_date}"
anchor_hday_hmonth_hyear: &hday_hmonth_hyear
  completionTimeFromAscendingNode:
    - |
      {{
        "hyear": {_date#interval_to_datetime_dict}["year"],
        "hmonth": {_date#interval_to_datetime_dict}["month"],
        "hday": {_date#interval_to_datetime_dict}["day"]
      }}
    - "{$.completionTimeFromAscendingNode#to_iso_date}"
anchor_hmonth_hyear: &hmonth_hyear
  completionTimeFromAscendingNode:
    - |
      {{
        "hyear": {_date#interval_to_datetime_dict}["year"],
        "hmonth": {_date#interval_to_datetime_dict}["month"]
      }}
    - "{$.completionTimeFromAscendingNode#to_iso_date}"
auth: !plugin
  type: HTTPHeaderAuth
  matching_url: https://ewds.climate.copernicus.eu
  ssl_verify: true
  headers:
    PRIVATE-TOKEN: "{apikey}"
download: !plugin
  type: HTTPDownload
  timeout: 30
  ssl_verify: true
  extract: false
  auth_error_code: 401
  order_enabled: true
  order_method: POST
  order_on_response:
    metadata_mapping:
      orderId: $.json.jobID
      orderStatusLink: https://ewds.climate.copernicus.eu/api/retrieve/v1/jobs/{orderId}
      searchLink: https://ewds.climate.copernicus.eu/api/retrieve/v1/jobs/{orderId}/results
  order_status:
    request:
      method: GET
    metadata_mapping:
      status: $.json.status
    error:
      status: failed
    success:
      status: successful
    on_success:
      need_search: true
      metadata_mapping:
        downloadLink: $.json.asset.value.href
  products:
    FIRE_HISTORICAL:
      output_extension: .grib
search: !plugin
  type: ECMWFSearch
  ssl_verify: true
  end_date_excluded: false
  dates_required: True
  remove_from_query:
    - dataset
    - date
  discover_queryables:
    fetch_url: null
    product_type_fetch_url: null
    constraints_url: https://ewds.climate.copernicus.eu/api/catalogue/v1/collections/{ecmwf:dataset}/constraints.json
    form_url: https://ewds.climate.copernicus.eu/api/catalogue/v1/collections/{ecmwf:dataset}/form.json
  metadata_mapping:
    productType: $.productType
    title: $.id
    startTimeFromAscendingNode: "{$.startTimeFromAscendingNode#to_iso_utc_datetime}"
    completionTimeFromAscendingNode:
      - date={startTimeFromAscendingNode#to_iso_date}/{completionTimeFromAscendingNode#to_iso_date}
      - "{$.completionTimeFromAscendingNode#to_iso_utc_datetime}"
    _date: "{startTimeFromAscendingNode#to_iso_date}/{completionTimeFromAscendingNode#to_iso_date}"
    id: $.id
    # The geographic extent of the product
    geometry:
      - '{{"area": {geometry#to_nwse_bounds}}}'
      - $.geometry
    defaultGeometry: POLYGON((180 -90, 180 90, -180 90, -180 -90, 180 -90))
    storageStatus: '{$.null#replace_str("Not Available","OFFLINE")}'
    downloadLink: $.null
    qs: $.qs
    orderLink: 'https://ewds.climate.copernicus.eu/api/retrieve/v1/processes/{ecmwf:dataset}/execution?{{"inputs": {qs#to_geojson}}}'
    "ecmwf:system_version":
      - system_version
      - '{$."ecmwf:system_version"#to_geojson}'
products:
  EFAS_HISTORICAL:
    "ecmwf:dataset": efas-historical
    "ecmwf:data_format": grib
    "ecmwf:download_format": zip
    "ecmwf:model_levels": surface_level
    "ecmwf:variable": snow_depth_water_equivalent
    "ecmwf:system_version": version_4_0
    "ecmwf:time": 06:00
    metadata_mapping:
      <<: *time_hday_hmonth_hyear
  EFAS_FORECAST:
    "ecmwf:dataset": efas-forecast
    "ecmwf:data_format": grib
    "ecmwf:download_format": zip
    "ecmwf:system_version": operational
    "ecmwf:originating_centre": ecmwf
    "ecmwf:product_type": control_forecast
    "ecmwf:variable":
      - river_discharge_in_the_last_6_hours
      - river_discharge_in_the_last_24_hours
    "ecmwf:model_levels": surface_level
    "ecmwf:time": 00:00
    "ecmwf:leadtime_hour": "24"
    metadata_mapping:
      <<: *time_day_month_year
  EFAS_SEASONAL:
    "ecmwf:dataset": efas-seasonal
    "ecmwf:system_version": operational
    "ecmwf:data_format": grib
    "ecmwf:download_format": zip
    "ecmwf:variable": river_discharge_in_the_last_24_hours
    "ecmwf:model_levels": surface_level
    "ecmwf:leadtime_hour": "24"
    metadata_mapping:
      <<: *month_year
  EFAS_REFORECAST:
    "ecmwf:dataset": efas-reforecast
    "ecmwf:system_version": version_4_0
    "ecmwf:data_format": grib
    "ecmwf:download_format": zip
    "ecmwf:product_type": control_forecast
    "ecmwf:variable": river_discharge_in_the_last_6_hours
    "ecmwf:model_levels": surface_level
    "ecmwf:leadtime_hour": "0"
    "ecmwf:hday": "03"
    metadata_mapping:
      <<: *hday_hmonth_hyear
  EFAS_SEASONAL_REFORECAST:
    "ecmwf:dataset": efas-seasonal-reforecast
    "ecmwf:system_version": version_5_0
    "ecmwf:data_format": grib
    "ecmwf:download_format": zip
    "ecmwf:variable": river_discharge_in_the_last_24_hours
    "ecmwf:model_levels": surface_level
    "ecmwf:leadtime_hour": "24"
    metadata_mapping:
      <<: *hmonth_hyear
  GLOFAS_HISTORICAL:
    "ecmwf:dataset": cems-glofas-historical
    "ecmwf:system_version": version_4_0
    "ecmwf:variable": river_discharge_in_the_last_24_hours
    "ecmwf:data_format": grib2
    "ecmwf:download_format": zip
    "ecmwf:hydrological_model": lisflood
    "ecmwf:product_type": consolidated
    metadata_mapping:
      <<: *hday_hmonth_hyear
  GLOFAS_FORECAST:
    "ecmwf:dataset": cems-glofas-forecast
    "ecmwf:system_version": operational
    "ecmwf:variable": river_discharge_in_the_last_24_hours
    "ecmwf:data_format": grib2
    "ecmwf:hydrological_model": htessel_lisflood
    "ecmwf:product_type": control_forecast
    "ecmwf:leadtime_hour": "24"
    "ecmwf:download_format": zip
    metadata_mapping:
      <<: *day_month_year
  GLOFAS_SEASONAL:
    "ecmwf:dataset": cems-glofas-seasonal
    "ecmwf:variable": river_discharge_in_the_last_24_hours
    "ecmwf:data_format": grib2
    "ecmwf:download_format": zip
    "ecmwf:system_version": operational
    "ecmwf:hydrological_model": htessel_lisflood
    "ecmwf:leadtime_hour": "24"
    metadata_mapping:
      <<: *month_year
  GLOFAS_SEASONAL_REFORECAST:
    "ecmwf:dataset": cems-glofas-seasonal-reforecast
    "ecmwf:data_format": grib2
    "ecmwf:download_format": zip
    "ecmwf:variable": river_discharge_in_the_last_24_hours
    "ecmwf:system_version": version_4_0
    "ecmwf:hydrological_model": lisflood
    "ecmwf:leadtime_hour": "24"
    "ecmwf:hday": "27"
    metadata_mapping:
      <<: *hday_hmonth_hyear
  GLOFAS_REFORECAST:
    "ecmwf:dataset": cems-glofas-reforecast
    "ecmwf:variable": river_discharge_in_the_last_24_hours
    "ecmwf:data_format": grib2
    "ecmwf:download_format": zip
    "ecmwf:system_version": version_3_1
    "ecmwf:hydrological_model": lisflood
    "ecmwf:product_type": control_reforecast
    "ecmwf:leadtime_hour": "24"
    "ecmwf:hday": "03"
    metadata_mapping:
      <<: *hday_hmonth_hyear
  FIRE_HISTORICAL:
    "ecmwf:dataset": cems-fire-historical-v1
    "ecmwf:grid": original_grid
    "ecmwf:dataset_type": consolidated_dataset
    "ecmwf:product_type": reanalysis
    "ecmwf:variable": build_up_index
    "ecmwf:system_version": "4_1"
    "ecmwf:data_format": grib
    metadata_mapping:
      <<: *day_month_year
---
!provider # MARK: planetary_computer
name: planetary_computer
priority: 0
roles:
  - host
description: Microsoft Planetary Computer
url: https://planetarycomputer.microsoft.com
search: !plugin
  type: StacSearch
  api_endpoint: https://planetarycomputer.microsoft.com/api/stac/v1/search
  need_auth: false
  pagination:
    max_items_per_page: 1000
  metadata_mapping:
    tileIdentifier:
      - '{{"query":{{"s2:mgrs_tile":{{"eq":"{tileIdentifier}"}}}}}}'
      - '$.properties."s2:mgrs_tile"'
products:
  LANDSAT_C2L1:
    productType: landsat-c2-l1
  LANDSAT_C2L2:
    productType: landsat-c2-l2
  GENERIC_PRODUCT_TYPE:
    productType: "{productType}"
download: !plugin
  type: HTTPDownload
  base_uri: "https://planetarycomputer.microsoft.com/api/stac/download"
  flatten_top_dirs: True
  auth_error_code: 403
auth: !plugin
  type: SASAuth
  matching_url: https://[-\w\.]+.blob.core.windows.net
  auth_uri: "https://planetarycomputer.microsoft.com/api/sas/v1/sign?href={url}"
  signed_url_key: href
  headers:
    Ocp-Apim-Subscription-Key: "{apikey}"
---
!provider # MARK: dedt_lumi
name: dedt_lumi
priority: 0
roles:
  - host
description: Destination Earth Digital Twin Outputs from LUMI through Polytope API
url: https://polytope.lumi.apps.dte.destination-earth.eu/openapi
search: !plugin
  type: ECMWFSearch
  ssl_verify: true
  dates_required: True
  discover_queryables:
    fetch_url: null
    product_type_fetch_url: null
    constraints_url: "https://s3.central.data.destination-earth.eu/swift/v1/dedt-lumi-constraints/{ecmwf:dataset}.json"
  metadata_mapping:
    productType: destination-earth
    storageStatus: OFFLINE
    startTimeFromAscendingNode: "{$.startTimeFromAscendingNode#to_iso_date}"
    completionTimeFromAscendingNode:
      - '{{"date": "{startTimeFromAscendingNode#to_non_separated_date}/to/{completionTimeFromAscendingNode#to_non_separated_date}"}}'
      - "{$.completionTimeFromAscendingNode#to_iso_date}"
    geometry: POLYGON((180 -90, 180 90, -180 90, -180 -90, 180 -90))
    qs: $.qs
    orderLink: 'https://polytope.lumi.apps.dte.destination-earth.eu/api/v1/requests/destination-earth?{{"verb": "retrieve", "request": {qs#to_geojson} }}'
    downloadLink: $.null
products:
  DT_EXTREMES:
    "ecmwf:dataset": extremes-dt
    "ecmwf:class": d1
    "ecmwf:expver": "0001"
    "ecmwf:stream": oper
    "ecmwf:type": fc
    "ecmwf:levtype": sfc
    "ecmwf:step": "0"
    "ecmwf:param": "31"
    "ecmwf:time": "0000"
  DT_CLIMATE_ADAPTATION:
    "ecmwf:dataset": climate-dt
    "ecmwf:class": d1
    "ecmwf:generation": 1
    "ecmwf:expver": "0001"
    "ecmwf:stream": clte
    "ecmwf:type": fc
    "ecmwf:activity": ScenarioMIP
    "ecmwf:experiment": SSP3-7.0
    "ecmwf:realization": 1
    "ecmwf:model": IFS-NEMO
    "ecmwf:param": 134/165/166
    "ecmwf:resolution": high
    "ecmwf:levtype": sfc
    "ecmwf:time": "0000"
download: !plugin
  type: HTTPDownload
  timeout: 60
  ssl_verify: true
  auth_error_code: 401
  order_enabled: True
  order_method: POST
  order_on_response:
    metadata_mapping:
      orderId: "{$.headers.Location#slice_str(-36,,1)}"
      _previousOrderId: '{$.json.orderId#replace_str("Not Available","")}'
      combinedOrderId: '{orderId#replace_str("Not Available","")}{_previousOrderId}'
      orderStatusLink: "https://polytope.lumi.apps.dte.destination-earth.eu/api/v1/requests/{combinedOrderId#replace_str(r'^$','Not Available')}"
  order_status:
    request:
      method: GET
      headers:
    metadata_mapping:
      status: $.json.status
      message: $.json.message
      error_message: $.null
    success:
      http_code: 303
    error:
      status: failed
    on_success:
      result_type: json
      metadata_mapping:
        downloadLink: $.headers.Location
  no_auth_download: True
  products:
    DT_EXTREMES:
      output_extension: .grib
    DT_CLIMATE_ADAPTATION:
      output_extension: .grib
auth: !plugin
  type: OIDCAuthorizationCodeFlowAuth
  matching_url: https://[-\w\.]+.dte.destination-earth.eu
  oidc_config_url: https://auth.destine.eu/realms/desp/.well-known/openid-configuration
  redirect_uri: https://polytope.lumi.apps.dte.destination-earth.eu/
  client_id: polytope-api-public
  user_consent_needed: false
  token_exchange_post_data_method: data
  token_provision: header
  login_form_xpath: //form[@id='kc-form-login']
  authentication_uri_source: login-form
---
!provider # MARK: eumetsat_ds
name: eumetsat
priority: 2
description: EUMETSAT Data Store
roles:
  - host
url: https://data.eumetsat.int
anchor_sentinel: &sentinel_params
  orbitDirection: "$.properties.acquisitionInformation[0].acquisitionParameters.orbitDirection"
  relativeOrbitNumber: "$.properties.acquisitionInformation[0].acquisitionParameters.relativeOrbitNumber"
  timeliness: "$.properties.productInformation.timeliness"
  cycleNumber: "$.properties.acquisitionInformation[0].acquisitionParameters.cycleNumber"
anchor_orbit_zone_tile: &orbit_zone_tile
  orbitNumber:
    - orbit
    - "$.properties.acquisitionInformation[0].acquisitionParameters.orbitNumber"
search: !plugin
  type: QueryStringSearch
  api_endpoint: "https://api.eumetsat.int/data/search-products/1.0.0/os"
  need_auth: false
  ssl_verify: true
  dont_quote:
    - "="
    - "&"
  pagination:
    next_page_url_tpl: "{url}?{search}&c={items_per_page}&pw={page}"
    start_page: 0
    total_items_nb_key_path: "$.totalResults"
    # 2024/02/01: 500 is the max, no error if greater
    max_items_per_page: 500
  sort:
    sort_by_default:
      - !!python/tuple [startTimeFromAscendingNode, ASC]
    sort_by_tpl: "&sort={sort_param},{sort_order}"
    sort_param_mapping:
      startTimeFromAscendingNode: start,time
      publicationDate: publicationDate,
    sort_order_mapping:
      ascending: "1"
      descending: "0"
    max_sort_params: 1
  literal_search_params:
    format: json
  discover_metadata:
    auto_discovery: true
    metadata_pattern: "^[a-zA-Z0-9_]+$"
    search_param: "{metadata}={{{metadata}}}"
    metadata_path: "$.properties.*"
  discover_product_types:
    fetch_url: https://api.eumetsat.int/data/browse/1.0.0/collections?format=json
    result_type: json
    results_entry: "$.links[*]"
    generic_product_type_id: "$.title"
    generic_product_type_parsable_properties:
      parentIdentifier: "$.title"
    generic_product_type_parsable_metadata:
      abstract: "$.null"
      instrument: "$.null"
      platform: "$.null"
      platformSerialIdentifier: "$.null"
      processingLevel: "$.null"
      keywords: "$.null"
      license: "$.null"
      title: "$.title"
      missionStartDate: "$.null"
  metadata_mapping:
    # Opensearch resource identifier within the search engine context (in our case
    # within the context of the data provider)
    uid: "$.id"
    # OpenSearch Parameters for Collection Search (Table 3)
    productType:
      - type
      - "$.properties.productInformation.productType"
    platform: "$.properties.acquisitionInformation[0].platform.platformShortName"
    instrument: "$.properties.acquisitionInformation[0].instrument.instrumentShortName"
    # INSPIRE obligated OpenSearch Parameters for Collection Search (Table 4)
    # OpenSearch Parameters for Product Search (Table 5)
    title: "{$.properties.title#remove_extension}"
    parentIdentifier:
      - pi
      - "$.properties.parentIdentifier"
    modificationDate: "$.properties.updated"
    # OpenSearch Parameters for Acquistion Parameters Search (Table 6)
    startTimeFromAscendingNode:
      - dtstart
      - '{$.properties.date#replace_str(r"\/.*","")}'
    completionTimeFromAscendingNode:
      - dtend
      - '{$.properties.date#replace_str(r".*\/","")}'
    # Custom parameters (not defined in the base document referenced above)
    id:
      - id
      - $.properties.identifier
    # The geographic extent of the product
    geometry:
      - "geo={geometry#to_rounded_wkt}"
      - "$.geometry"
    defaultGeometry: "POLYGON((180 -90, 180 90, -180 90, -180 -90, 180 -90))"
    # The url of the quicklook
    quicklook: '$.properties.links.previews[?(@.title="Quicklook")].href'
    # The url to download the product "as is" (literal or as a template to be completed either after the search result
    # is obtained from the provider or during the eodag download phase)
    downloadLink: '$.properties.links.data[?(@.title="Product download")].href'
    # storageStatus set to ONLINE for consistency between providers
    storageStatus: '{$.null#replace_str("Not Available","ONLINE")}'
    assets: "{$.properties.links.sip-entries#assets_list_to_dict}"
    # Additional metadata provided by the providers but that don't appear in the reference spec
    size: "$.properties.productInformation.size"
    type: "$.null"
    # set duplicate metadata due to metadata discovery to null
    acquisitionInformation: "$.null"
    productInformation: "$.null"
    extraInformation: "$.null"
products:
  # S3 SRAL
  S3_SRA:
    productType: SR_1_SRA___
    parentIdentifier: EO:EUM:DAT:0406
    metadata_mapping:
      <<: *orbit_zone_tile
      <<: *sentinel_params
  S3_SRA_A:
    productType: SR_1_SRA_A_
    parentIdentifier: EO:EUM:DAT:0413
    metadata_mapping:
      <<: *orbit_zone_tile
      <<: *sentinel_params
  S3_SRA_BS:
    productType: SR_1_SRA_BS
    parentIdentifier: EO:EUM:DAT:0414
    metadata_mapping:
      <<: *orbit_zone_tile
      <<: *sentinel_params
  S3_WAT:
    productType: SR_2_WAT___
    parentIdentifier: EO:EUM:DAT:0415
    metadata_mapping:
      <<: *orbit_zone_tile
      <<: *sentinel_params
  # S3 OLCI
  S3_EFR:
    productType: OL_1_EFR___
    parentIdentifier: EO:EUM:DAT:0409
    metadata_mapping:
      <<: *orbit_zone_tile
      <<: *sentinel_params
  S3_ERR:
    productType: OL_1_ERR___
    parentIdentifier: EO:EUM:DAT:0410
    metadata_mapping:
      <<: *orbit_zone_tile
      <<: *sentinel_params
  S3_OLCI_L2WRR:
    productType: OL_2_WRR___
    parentIdentifier: EO:EUM:DAT:0408
    metadata_mapping:
      <<: *orbit_zone_tile
      <<: *sentinel_params
  S3_OLCI_L2WFR:
    productType: OL_2_WFR___
    parentIdentifier: EO:EUM:DAT:0407
    metadata_mapping:
      <<: *orbit_zone_tile
      <<: *sentinel_params
  # S3 SLSTR
  S3_SLSTR_L1RBT:
    productType: SL_1_RBT___
    parentIdentifier: EO:EUM:DAT:0411
    metadata_mapping:
      <<: *orbit_zone_tile
      <<: *sentinel_params
  S3_SLSTR_L2WST:
    productType: SL_2_WST___
    parentIdentifier: EO:EUM:DAT:0412
    metadata_mapping:
      <<: *orbit_zone_tile
      <<: *sentinel_params
  S3_SLSTR_L2AOD:
    productType: SL_2_AOD___
    parentIdentifier: EO:EUM:DAT:0416
    metadata_mapping:
      <<: *orbit_zone_tile
      <<: *sentinel_params
  S3_SLSTR_L2FRP:
    productType: SL_2_FRP___
    parentIdentifier: EO:EUM:DAT:0417
    metadata_mapping:
      <<: *orbit_zone_tile
      <<: *sentinel_params
      fire:
        - fire
        - "$.properties.extraInformation.fireDetected"
  # S6
  S6_RADIO_OCCULTATION:
    productType: RO_1B_BND____
    parentIdentifier: EO:EUM:DAT:0853
    metadata_mapping:
      <<: *orbit_zone_tile
      <<: *sentinel_params
  # METOP
  METOP_AMSU_L1:
    parentIdentifier: EO:EUM:DAT:METOP:AMSUL1
    metadata_mapping:
      <<: *orbit_zone_tile
  METOP_OSI_104:
    parentIdentifier: EO:EUM:DAT:METOP:OSI-104
    metadata_mapping:
      <<: *orbit_zone_tile
  METOP_OSI_150A:
    parentIdentifier: EO:EUM:DAT:METOP:OSI-150-A
    metadata_mapping:
      <<: *orbit_zone_tile
  METOP_OSI_150B:
    parentIdentifier: EO:EUM:DAT:METOP:OSI-150-B
    metadata_mapping:
      <<: *orbit_zone_tile
  METOP_ASCSZF1B:
    parentIdentifier: EO:EUM:DAT:METOP:ASCSZF1B
    metadata_mapping:
      <<: *orbit_zone_tile
  METOP_ASCSZR1B:
    parentIdentifier: EO:EUM:DAT:METOP:ASCSZR1B
    metadata_mapping:
      <<: *orbit_zone_tile
  METOP_ASCSZO1B:
    parentIdentifier: EO:EUM:DAT:METOP:ASCSZO1B
    metadata_mapping:
      <<: *orbit_zone_tile
  METOP_ASCSZFR02:
    parentIdentifier: EO:EUM:CM:METOP:ASCSZFR02
    metadata_mapping:
      <<: *orbit_zone_tile
  METOP_ASCSZOR02:
    parentIdentifier: EO:EUM:CM:METOP:ASCSZOR02
    metadata_mapping:
      <<: *orbit_zone_tile
  METOP_ASCSZRR02:
    parentIdentifier: EO:EUM:CM:METOP:ASCSZRR02
    metadata_mapping:
      <<: *orbit_zone_tile
  METOP_AVHRRL1:
    parentIdentifier: EO:EUM:DAT:METOP:AVHRRL1
    metadata_mapping:
      <<: *orbit_zone_tile
  METOP_SOMO12:
    parentIdentifier: EO:EUM:DAT:METOP:SOMO12
    metadata_mapping:
      <<: *orbit_zone_tile
  METOP_SOMO25:
    parentIdentifier: EO:EUM:DAT:METOP:SOMO25
    metadata_mapping:
      <<: *orbit_zone_tile
  METOP_AVHRRGACR02:
    parentIdentifier: EO:EUM:DAT:0558
  METOP_LSA_002:
    parentIdentifier: EO:EUM:DAT:METOP:LSA-002
  METOP_GLB_SST_NC:
    parentIdentifier: EO:EUM:DAT:METOP:GLB-SST-NC
  METOP_GOMEL1:
    parentIdentifier: EO:EUM:DAT:METOP:GOMEL1
    metadata_mapping:
      <<: *orbit_zone_tile
  METOP_GOMEL1R03:
    parentIdentifier: EO:EUM:DAT:0533
    metadata_mapping:
      <<: *orbit_zone_tile
  METOP_IASTHR011:
    parentIdentifier: EO:EUM:DAT:0576
    metadata_mapping:
      <<: *orbit_zone_tile
  METOP_IASSND02:
    parentIdentifier: EO:EUM:DAT:METOP:IASSND02
    metadata_mapping:
      <<: *orbit_zone_tile
  METOP_IASIL1C_ALL:
    parentIdentifier: EO:EUM:DAT:METOP:IASIL1C-ALL
    metadata_mapping:
      <<: *orbit_zone_tile
  METOP_MHSL1:
    parentIdentifier: EO:EUM:DAT:METOP:MHSL1
    metadata_mapping:
      <<: *orbit_zone_tile
  METOP_HIRSL1:
    parentIdentifier: EO:EUM:DAT:MULT:HIRSL1
    metadata_mapping:
      <<: *orbit_zone_tile
  # MSG
  MSG_CLM:
    parentIdentifier: EO:EUM:DAT:MSG:CLM
  MSG_CLM_IODC:
    parentIdentifier: EO:EUM:DAT:MSG:CLM-IODC
  MSG_GSAL2R02:
    parentIdentifier: EO:EUM:DAT:0300
  MSG_HRSEVIRI:
    parentIdentifier: EO:EUM:DAT:MSG:HRSEVIRI
  MSG_HRSEVIRI_IODC:
    parentIdentifier: EO:EUM:DAT:MSG:HRSEVIRI-IODC
  MSG_RSS_CLM:
    parentIdentifier: EO:EUM:DAT:MSG:RSS-CLM
  MSG_MSG15_RSS:
    parentIdentifier: EO:EUM:DAT:MSG:MSG15-RSS
  MSG_LSA_FRM:
    parentIdentifier: EO:EUM:DAT:0398
  MSG_LSA_LST_CDR:
    parentIdentifier: EO:EUM:DAT:0088
  MSG_LSA_LSTDE:
    parentIdentifier: EO:EUM:DAT:0394
  MSG_AMVR02:
    parentIdentifier: EO:EUM:DAT:0405
  MSG_OCA_CDR:
    parentIdentifier: EO:EUM:DAT:0617
  # MFG
  MFG_GSA_57:
    parentIdentifier: EO:EUM:DAT:0301
  MFG_GSA_63:
    parentIdentifier: EO:EUM:DAT:0302
  # MTG
  MTG_FCI_AMV_BUFR:
    parentIdentifier: EO:EUM:DAT:0998
  MTG_FCI_AMV_NETCDF:
    parentIdentifier: EO:EUM:DAT:0676
  MTG_FCI_ASR_BUFR:
    parentIdentifier: EO:EUM:DAT:0799
  MTG_FCI_ASR_NETCDF:
    parentIdentifier: EO:EUM:DAT:0677
  MTG_FCI_CLM:
    parentIdentifier: EO:EUM:DAT:0678
  MTG_FCI_FDHSI:
    parentIdentifier: EO:EUM:DAT:0662
  MTG_FCI_HRFI:
    parentIdentifier: EO:EUM:DAT:0665
  MTG_FCI_GII:
    parentIdentifier: EO:EUM:DAT:0683
  MTG_FCI_OCA:
    parentIdentifier: EO:EUM:DAT:0684
  MTG_FCI_OLR:
    parentIdentifier: EO:EUM:DAT:0685
  MTG_LI_AF:
    parentIdentifier: EO:EUM:DAT:0686
  MTG_LI_AFA:
    parentIdentifier: EO:EUM:DAT:0687
  MTG_LI_AFR:
    parentIdentifier: EO:EUM:DAT:0688
  MTG_LI_LEF:
    parentIdentifier: EO:EUM:DAT:0690
  MTG_LI_LFL:
    parentIdentifier: EO:EUM:DAT:0691
  MTG_LI_LGR:
    parentIdentifier: EO:EUM:DAT:0782
  # MULT
  HIRS_FDR_1_MULTI:
    parentIdentifier: EO:EUM:DAT:0647
  GENERIC_PRODUCT_TYPE:
    productType: "{productType}"
    parentIdentifier: "{parentIdentifier}"
download: !plugin
  type: HTTPDownload
  extract: true
  ignore_assets: True
  ssl_verify: true
auth: !plugin
  type: TokenAuth
  matching_url: https://api.eumetsat.int
  auth_uri: "https://api.eumetsat.int/token"
  auth_error_code: 401
  req_data:
    grant_type: client_credentials
  token_type: json
  token_key: access_token
  ssl_verify: true
---
!provider # MARK: cop_marine
name: cop_marine
priority: 0
description: Copernicus Marine Data Store
roles:
  - host
url: https://marine.copernicus.eu/
search: !plugin
  type: CopMarineSearch
  api_endpoint: "https://stac.marine.copernicus.eu/metadata/{collection}/product.stac.json"
  need_auth: false
  ssl_verify: true
  timeout: 20
  results_entry: links
  discover_product_types:
    fetch_url: "https://stac.marine.copernicus.eu/metadata/catalog.stac.json"
    result_type: json
    results_entry: "$.collections[*]"
    generic_product_type_id: "$.id"
    generic_product_type_parsable_properties:
      collection: "$.id"
    generic_product_type_parsable_metadata:
      instrument: "$.null"
      platform: "$.null"
      platformSerialIdentifier: "$.null"
      processingLevel: "$.properties.processingLevel"
      keywords: "$.keywords"
      license: "$.license"
      title: "$.title"
      missionStartDate: "$.extent.temporal.interval[0][0]"
      abstract: "$.description"
      providers: "$.providers"
      doi: "$.sci:doi"
  discover_metadata:
    auto_discovery: false
  discover_queryables:
    fetch_url: null
  metadata_mapping:
    defaultGeometry: "POLYGON((180 -90, 180 90, -180 90, -180 -90, 180 -90))"
products:
  MO_GLOBAL_ANALYSISFORECAST_PHY_001_024:
    productType: GLOBAL_ANALYSISFORECAST_PHY_001_024
  MO_GLOBAL_ANALYSISFORECAST_BGC_001_028:
    productType: GLOBAL_ANALYSISFORECAST_BGC_001_028
  MO_GLOBAL_ANALYSISFORECAST_WAV_001_027:
    productType: GLOBAL_ANALYSISFORECAST_WAV_001_027
  MO_GLOBAL_MULTIYEAR_BGC_001_033:
    productType: GLOBAL_MULTIYEAR_BGC_001_033
  MO_GLOBAL_MULTIYEAR_WAV_001_032:
    productType: GLOBAL_MULTIYEAR_WAV_001_032
  MO_GLOBAL_MULTIYEAR_PHY_ENS_001_031:
    productType: GLOBAL_MULTIYEAR_PHY_ENS_001_031
  MO_INSITU_GLO_PHY_UV_DISCRETE_NRT_013_048:
    productType: INSITU_GLO_PHY_UV_DISCRETE_NRT_013_048
    code_mapping:
      param: platformSerialIdentifier
      index: 3
  MO_INSITU_GLO_PHY_TS_OA_NRT_013_002:
    productType: INSITU_GLO_PHY_TS_OA_NRT_013_002
    code_mapping:
      param: analysis_name
      index: 1
  MO_INSITU_GLO_PHY_TS_OA_MY_013_052:
    productType: INSITU_GLO_PHY_TS_OA_MY_013_052
    code_mapping:
      param: analysis_name
      index: 1
  MO_MULTIOBS_GLO_BIO_BGC_3D_REP_015_010:
    productType: MULTIOBS_GLO_BIO_BGC_3D_REP_015_010
  MO_MULTIOBS_GLO_BIO_CARBON_SURFACE_MYNRT_015_008:
    productType: MULTIOBS_GLO_BIO_CARBON_SURFACE_MYNRT_015_008
  MO_MULTIOBS_GLO_BGC_NUTRIENTS_CARBON_PROFILES_MYNRT_015_009:
    productType: MULTIOBS_GLO_BGC_NUTRIENTS_CARBON_PROFILES_MYNRT_015_009
  MO_MULTIOBS_GLO_PHY_MYNRT_015_003:
    productType: MULTIOBS_GLO_PHY_MYNRT_015_003
  MO_MULTIOBS_GLO_PHY_S_SURFACE_MYNRT_015_013:
    productType: MULTIOBS_GLO_PHY_S_SURFACE_MYNRT_015_013
  MO_MULTIOBS_GLO_PHY_TSUV_3D_MYNRT_015_012:
    productType: MULTIOBS_GLO_PHY_TSUV_3D_MYNRT_015_012
  MO_MULTIOBS_GLO_PHY_W_3D_REP_015_007:
    productType: MULTIOBS_GLO_PHY_W_3D_REP_015_007
  MO_SEAICE_GLO_SEAICE_L4_NRT_OBSERVATIONS_011_001:
    productType: SEAICE_GLO_SEAICE_L4_NRT_OBSERVATIONS_011_001
  MO_SEAICE_GLO_SEAICE_L4_REP_OBSERVATIONS_011_009:
    productType: SEAICE_GLO_SEAICE_L4_REP_OBSERVATIONS_011_009
  MO_SEAICE_GLO_SEAICE_L4_NRT_OBSERVATIONS_011_006:
    productType: SEAICE_GLO_SEAICE_L4_NRT_OBSERVATIONS_011_006
  MO_SEALEVEL_GLO_PHY_L4_NRT_008_046:
    productType: SEALEVEL_GLO_PHY_L4_NRT_008_046
  MO_SEALEVEL_GLO_PHY_MDT_008_063:
    productType: SEALEVEL_GLO_PHY_MDT_008_063
  MO_SST_GLO_SST_L3S_NRT_OBSERVATIONS_010_010:
    productType: SST_GLO_SST_L3S_NRT_OBSERVATIONS_010_010
    code_mapping:
      param: sensorType
      index: 3
      pattern: "[A-Z]{3}"
  MO_SST_GLO_SST_L4_NRT_OBSERVATIONS_010_001:
    productType: SST_GLO_SST_L4_NRT_OBSERVATIONS_010_001
  MO_SST_GLO_SST_L4_REP_OBSERVATIONS_010_011:
    productType: SST_GLO_SST_L4_REP_OBSERVATIONS_010_011
  MO_SST_GLO_SST_L4_REP_OBSERVATIONS_010_024:
    productType: SST_GLO_SST_L4_REP_OBSERVATIONS_010_024
  MO_WAVE_GLO_PHY_SPC_FWK_L3_NRT_014_002:
    productType: WAVE_GLO_PHY_SPC-FWK_L3_NRT_014_002
    code_mapping:
      param: platformSerialIdentifier
      index: 0
      pattern: "s1a|s1b|cfo"
  MO_WAVE_GLO_PHY_SWH_L3_NRT_014_001:
    productType: WAVE_GLO_PHY_SWH_L3_NRT_014_001
    code_mapping:
      param: platformSerialIdentifier
      index: 4
  MO_WAVE_GLO_PHY_SWH_L4_NRT_014_003:
    productType: WAVE_GLO_PHY_SWH_L4_NRT_014_003
  MO_WIND_GLO_PHY_CLIMATE_L4_MY_012_003:
    productType: WIND_GLO_PHY_CLIMATE_L4_MY_012_003
  MO_WIND_GLO_PHY_L3_NRT_012_002:
    productType: WIND_GLO_PHY_L3_NRT_012_002
  MO_WIND_GLO_PHY_L3_MY_012_005:
    productType: WIND_GLO_PHY_L3_MY_012_005
  MO_WIND_GLO_PHY_L4_NRT_012_004:
    productType: WIND_GLO_PHY_L4_NRT_012_004
  MO_WIND_GLO_PHY_L4_MY_012_006:
    productType: WIND_GLO_PHY_L4_MY_012_006
  MO_OCEANCOLOUR_GLO_BGC_L3_MY_009_107:
    productType: OCEANCOLOUR_GLO_BGC_L3_MY_009_107
  MO_OCEANCOLOUR_GLO_BGC_L3_NRT_009_101:
    productType: OCEANCOLOUR_GLO_BGC_L3_NRT_009_101
    code_mapping:
      param: sensorType
      index: 6
      pattern: "olci|gapfree-multi|multi-climatology|multi"
  MO_OCEANCOLOUR_GLO_BGC_L3_MY_009_103:
    productType: OCEANCOLOUR_GLO_BGC_L3_MY_009_103
    code_mapping:
      param: sensorType
      index: 6
      pattern: "olci|gapfree-multi|multi-climatology|multi"
  MO_OCEANCOLOUR_GLO_BGC_L4_NRT_009_102:
    productType: OCEANCOLOUR_GLO_BGC_L4_NRT_009_102
    code_mapping:
      param: sensorType
      index: 6
      pattern: "olci|gapfree-multi|multi-climatology|multi"
  MO_OCEANCOLOUR_GLO_BGC_L4_MY_009_104:
    productType: OCEANCOLOUR_GLO_BGC_L4_MY_009_104
    code_mapping:
      param: sensorType
      index: 6
      pattern: "olci|gapfree-multi|multi-climatology|multi"
  MO_OCEANCOLOUR_GLO_BGC_L4_MY_009_108:
    productType: OCEANCOLOUR_GLO_BGC_L4_MY_009_108
  GENERIC_PRODUCT_TYPE:
    productType: "{productType}"
    collection: "{collection}"
download: !plugin
  type: AwsDownload
  s3_endpoint: https://s3.waw3-1.cloudferro.com
  bucket_path_level: 0
auth: !plugin
  type: AwsAuth
  matching_url: s3://
  matching_conf:
    s3_endpoint: https://s3.waw3-1.cloudferro.com
---
!provider # MARK: wekeo_main
name: wekeo_main # wekeo_main
group: wekeo
priority: 0
roles:
  - host
description: WEkEO - Sentinel and some various Copernicus data
url: https://www.wekeo.eu/
# anchors to avoid duplications
anchor_dates_eum: &eo_eum_dates
  startTimeFromAscendingNode:
    - '{{"dtstart": "{startTimeFromAscendingNode}"}}'
    - "$.properties.startdate"
  completionTimeFromAscendingNode:
    - '{{"dtend": "{completionTimeFromAscendingNode}"}}'
    - "$.properties.enddate"
anchor_dates_clms: &clms_dates
  startTimeFromAscendingNode:
    - '{{"start": "{startTimeFromAscendingNode}"}}'
    - "$.properties.startdate"
  completionTimeFromAscendingNode:
    - '{{"end": "{completionTimeFromAscendingNode}"}}'
    - "$.properties.enddate"
anchor_s1_sar: &s1_sar_params
  processingLevel:
    - '{{"processingLevel": "{processingLevel}"}}'
    - '$.id.`sub(/^[^_]([^_]+)_([^_]+)_([^_]+)_([0-4]+).*/, LEVEL\\4)`'
  sensorMode:
    - '{{"sensorMode": "{sensorMode}"}}'
    - '$.id.`sub(/^[^_]([^_]+)_([^_]+)_.*/, \\2)`'
  swath:
    - '{{"swath": "{swath}"}}'
    - "$.null"
  polarisation:
    - '{{"polarisation": "{polarisation}"}}'
    - "$.null"
  relativeOrbitNumber:
    - '{{"relativeOrbitNumber": "{relativeOrbitNumber}"}}'
    - "$.null"
  missionTakeId:
    - '{{"missionTakeId": "{missionTakeId}"}}'
    - "$.null"
anchor_orbit_cycle: &orbit_cycle
  relativeOrbitNumber:
    - '{{"relativeOrbitNumber": "{relativeOrbitNumber}"}}'
    - "$.null"
  orbitNumber:
    - '{{"orbit": "{orbitNumber}"}}'
    - "$.null"
  cycleNumber:
    - '{{"cycle": "{cycleNumber}"}}'
    - "$.null"
anchor_id_from_date: &id_from_date
  id:
    - |
      {{
        "start": "{id#replace_str(r'^.*_([0-9][0-9][0-9][0-9])([0-9][0-9])([0-9][0-9])([0-9][0-9])([0-9][0-9])_.*$',r'\1-\2-\3T\4%3A\5%3A00Z')}",
        "end": "{id#replace_str(r'^.*_([0-9][0-9][0-9][0-9])([0-9][0-9])([0-9][0-9])([0-9][0-9])([0-9][0-9])_.*$',r'\1-\2-\3T\4%3A\5%3A00Z')}"
      }}
    - "$.id"
search: !plugin
  type: PostJsonSearchWithStacQueryables
  api_endpoint: https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/search
  timeout: 60
  need_auth: true
  auth_error_code: 401
  results_entry: "features"
  two_passes_id_search: true
  pagination:
    total_items_nb_key_path: "$.properties.totalResults"
    next_page_query_obj: '{{"itemsPerPage":{items_per_page},"startIndex":{skip}}}'
    max_items_per_page: 200
  discover_product_types:
    fetch_url: null
  discover_queryables:
    fetch_url: null
    product_type_fetch_url: "https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/queryable/{provider_product_type}"
    result_type: json
    results_entry: "$.properties[*]"
  metadata_mapping:
    productType:
      - '{{"dataset_id": "{productType}"}}'
      - "$.null"
    geometry:
      - '{{"bbox": {geometry#to_bounds}}}'
      - "$.geometry"
    defaultGeometry: "POLYGON((180 -90, 180 90, -180 90, -180 -90, 180 -90))"
    id:
      - '{{"productIdentifier": "{id}"}}'
      - "{$.id#remove_extension}"
    startTimeFromAscendingNode:
      - '{{"startDate": "{startTimeFromAscendingNode}"}}'
      - "$.properties.startdate"
    completionTimeFromAscendingNode:
      - '{{"completionDate": "{completionTimeFromAscendingNode}"}}'
      - "$.properties.enddate"
    downloadLink: "$.properties.location"
    title: "$.id"
    storageStatus: "OFFLINE"
    processingLevel:
      - '{{"processingLevel": "{processingLevel}"}}'
      - "$.null"
    providerProductType:
      - '{{"productType": "{providerProductType}"}}'
      - "$.null"
    timeliness:
      - '{{"timeliness": "{timeliness}"}}'
      - "$.null"
    orbitDirection:
      - '{{"orbitDirection": "{orbitDirection}"}}'
      - "$.null"
    variable:
      - '{{"variable": "{variable}"}}'
      - "$.null"
    system:
      - '{{"system": "{system}"}}'
      - "$.null"
    version:
      - '{{"version": {version}}}'
      - "$.null"
    region:
      - '{{"region": {region}}}'
      - "$.null"
    type:
      - '{{"type": "{type}"}}'
      - "$.null"
    source:
      - '{{"source": {source}}}'
      - "$.null"
    model:
      - '{{"model": {model}}}'
      - "$.null"
    level:
      - '{{"level": {level}}}'
      - "$.null"
    step:
      - '{{"step": {step}}}'
      - "$.null"
    satellite:
      - '{{"satellite": {satellite}}}'
      - "$.null"
products:
  S1_SAR_GRD:
    productType: EO:ESA:DAT:SENTINEL-1
    providerProductType: GRD
    metadata_mapping:
      <<: *s1_sar_params
      orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "EO:ESA:DAT:SENTINEL-1"}}'
  S1_SAR_SLC:
    productType: EO:ESA:DAT:SENTINEL-1
    providerProductType: SLC
    metadata_mapping:
      <<: *s1_sar_params
      orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "EO:ESA:DAT:SENTINEL-1"}}'
  S2_MSI_L1C:
    productType: EO:ESA:DAT:SENTINEL-2
    processingLevel: S2MSI1C
    metadata_mapping:
      processingLevel:
        - '{{"processingLevel": "{processingLevel}"}}'
        - '$.id.`sub(/^[^_]([^_]+)_([^_]+)_.*/, S2\\2)`'
      cloudCover:
        - '{{"cloudCover": "{cloudCover}"}}'
        - "$.null"
      orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "EO:ESA:DAT:SENTINEL-2"}}'
  S2_MSI_L2A:
    productType: EO:ESA:DAT:SENTINEL-2
    processingLevel: S2MSI2A
    metadata_mapping:
      processingLevel:
        - '{{"processingLevel": "{processingLevel}"}}'
        - '$.id.`sub(/^[^_]([^_]+)_([^_]+)_.*/, S2\\2)`'
      cloudCover:
        - '{{"cloudCover": "{cloudCover}"}}'
        - "$.null"
      orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "EO:ESA:DAT:SENTINEL-2"}}'
  S3_OLCI_L2LFR:
    productType: EO:ESA:DAT:SENTINEL-3
    providerProductType: OL_2_LFR___
    processingLevel: 2
    metadata_mapping:
      processingLevel:
        - '{{"processingLevel": "{processingLevel}"}}'
        - "2"
      orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "EO:ESA:DAT:SENTINEL-3"}}'
  S3_OLCI_L2LRR:
    productType: EO:ESA:DAT:SENTINEL-3
    providerProductType: OL_2_LRR___
    processingLevel: 2
    metadata_mapping:
      processingLevel:
        - '{{"processingLevel": "{processingLevel}"}}'
        - "2"
      orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "EO:ESA:DAT:SENTINEL-3"}}'
  S3_EFR:
    productType: EO:EUM:DAT:SENTINEL-3:OL_1_EFR___
    metadata_mapping:
      id:
        - '{{"timeliness": {id#split_id_into_s3_params}["timeliness"], "sat": {id#split_id_into_s3_params}["sat"], "dtstart": {id#split_id_into_s3_params}["startDate"], "dtend": {id#split_id_into_s3_params}["endDate"]}}'
        - "{$.id#remove_extension}"
      <<: *eo_eum_dates
      platform:
        - '{{"sat": "{platform}"}}'
        - '$.id.`sub(/^[^_]([^_]+)_.*/, Sentinel-\\1)`'
      platformSerialIdentifier: '$.id.`sub(/^[^_]([^_]+)_.*/, S\\1)`'
      <<: *orbit_cycle
      orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "EO:EUM:DAT:SENTINEL-3:OL_1_EFR___"}}'
  S3_ERR:
    productType: EO:EUM:DAT:SENTINEL-3:OL_1_ERR___
    metadata_mapping:
      id:
        - '{{"timeliness": {id#split_id_into_s3_params}["timeliness"], "sat": {id#split_id_into_s3_params}["sat"], "dtstart": {id#split_id_into_s3_params}["startDate"], "dtend": {id#split_id_into_s3_params}["endDate"]}}'
        - "{$.id#remove_extension}"
      <<: *eo_eum_dates
      platform:
        - '{{"sat": "{platform}"}}'
        - '$.id.`sub(/^[^_]([^_]+)_.*/, Sentinel-\\1)`'
      platformSerialIdentifier: '$.id.`sub(/^[^_]([^_]+)_.*/, S\\1)`'
      <<: *orbit_cycle
      orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "EO:EUM:DAT:SENTINEL-3:OL_1_ERR___"}}'
  S3_OLCI_L2WFR:
    productType: EO:EUM:DAT:SENTINEL-3:OL_2_WFR___
    metadata_mapping:
      id:
        - '{{"timeliness": {id#split_id_into_s3_params}["timeliness"], "sat": {id#split_id_into_s3_params}["sat"], "dtstart": {id#split_id_into_s3_params}["startDate"], "dtend": {id#split_id_into_s3_params}["endDate"]}}'
        - "{$.id#remove_extension}"
      <<: *eo_eum_dates
      platform:
        - '{{"sat": "{platform}"}}'
        - '$.id.`sub(/^[^_]([^_]+)_.*/, Sentinel-\\1)`'
      platformSerialIdentifier: '$.id.`sub(/^[^_]([^_]+)_.*/, S\\1)`'
      <<: *orbit_cycle
      orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "EO:EUM:DAT:SENTINEL-3:OL_2_WFR___"}}'
  S3_OLCI_L2WRR:
    productType: EO:EUM:DAT:SENTINEL-3:OL_2_WRR___
    metadata_mapping:
      id:
        - '{{"timeliness": {id#split_id_into_s3_params}["timeliness"], "sat": {id#split_id_into_s3_params}["sat"], "dtstart": {id#split_id_into_s3_params}["startDate"], "dtend": {id#split_id_into_s3_params}["endDate"]}}'
        - "{$.id#remove_extension}"
      <<: *eo_eum_dates
      platform:
        - '{{"sat": "{platform}"}}'
        - '$.id.`sub(/^[^_]([^_]+)_.*/, Sentinel-\\1)`'
      platformSerialIdentifier: '$.id.`sub(/^[^_]([^_]+)_.*/, S\\1)`'
      <<: *orbit_cycle
      orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "EO:EUM:DAT:SENTINEL-3:OL_2_WRR___"}}'
  S3_SRA:
    productType: EO:EUM:DAT:SENTINEL-3:SR_1_SRA___
    metadata_mapping:
      id:
        - '{{"timeliness": {id#split_id_into_s3_params}["timeliness"], "sat": {id#split_id_into_s3_params}["sat"], "dtstart": {id#split_id_into_s3_params}["startDate"], "dtend": {id#split_id_into_s3_params}["endDate"]}}'
        - "{$.id#remove_extension}"
      <<: *eo_eum_dates
      platform:
        - '{{"sat": "{platform}"}}'
        - '$.id.`sub(/^[^_]([^_]+)_.*/, Sentinel-\\1)`'
      platformSerialIdentifier: '$.id.`sub(/^[^_]([^_]+)_.*/, S\\1)`'
      <<: *orbit_cycle
      orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "EO:EUM:DAT:SENTINEL-3:SR_1_SRA___"}}'
  S3_SRA_A:
    productType: EO:EUM:DAT:SENTINEL-3:SR_1_SRA_A_
    metadata_mapping:
      id:
        - '{{"timeliness": {id#split_id_into_s3_params}["timeliness"], "sat": {id#split_id_into_s3_params}["sat"], "dtstart": {id#split_id_into_s3_params}["startDate"], "dtend": {id#split_id_into_s3_params}["endDate"]}}'
        - "{$.id#remove_extension}"
      <<: *eo_eum_dates
      platform:
        - '{{"sat": "{platform}"}}'
        - '$.id.`sub(/^[^_]([^_]+)_.*/, Sentinel-\\1)`'
      platformSerialIdentifier: '$.id.`sub(/^[^_]([^_]+)_.*/, S\\1)`'
      <<: *orbit_cycle
      orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "EO:EUM:DAT:SENTINEL-3:SR_1_SRA_A_"}}'
  S3_SRA_BS:
    productType: EO:EUM:DAT:SENTINEL-3:SR_1_SRA_BS
    metadata_mapping:
      id:
        - '{{"timeliness": {id#split_id_into_s3_params}["timeliness"], "sat": {id#split_id_into_s3_params}["sat"], "dtstart": {id#split_id_into_s3_params}["startDate"], "dtend": {id#split_id_into_s3_params}["endDate"]}}'
        - "{$.id#remove_extension}"
      <<: *eo_eum_dates
      platform:
        - '{{"sat": "{platform}"}}'
        - '$.id.`sub(/^[^_]([^_]+)_.*/, Sentinel-\\1)`'
      platformSerialIdentifier: '$.id.`sub(/^[^_]([^_]+)_.*/, S\\1)`'
      <<: *orbit_cycle
      orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "EO:EUM:DAT:SENTINEL-3:SR_1_SRA_BS"}}'

  S3_SLSTR_L1RBT:
    productType: EO:EUM:DAT:SENTINEL-3:SL_1_RBT___
    providerProductType: SL_1_RBT___
    metadata_mapping:
      id:
        - '{{"productType": "SL_1_RBT___", "timeliness": {id#split_id_into_s3_params}["timeliness"], "sat": {id#split_id_into_s3_params}["sat"], "dtstart": {id#split_id_into_s3_params}["startDate"], "dtend": {id#split_id_into_s3_params}["endDate"]}}'
        - "{$.id#remove_extension}"
      <<: *eo_eum_dates
      platform:
        - '{{"sat": "{platform}"}}'
        - '$.id.`sub(/^[^_]([^_]+)_.*/, Sentinel-\\1)`'
      platformSerialIdentifier: '$.id.`sub(/^[^_]([^_]+)_.*/, S\\1)`'
      <<: *orbit_cycle
      orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "EO:EUM:DAT:SENTINEL-3:SL_1_RBT___"}}'
  S3_WAT:
    productType: EO:EUM:DAT:SENTINEL-3:SR_2_WAT___
    metadata_mapping:
      id:
        - '{{"type": "SR_2_WAT___", "timeliness": {id#split_id_into_s3_params}["timeliness"], "sat": {id#split_id_into_s3_params}["sat"], "dtstart": {id#split_id_into_s3_params}["startDate"], "dtend": {id#split_id_into_s3_params}["endDate"]}}'
        - "{$.id#remove_extension}"
      <<: *eo_eum_dates
      orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "EO:EUM:DAT:SENTINEL-3:SR_2_WAT___"}}'
  S5P_L1B_IR_ALL:
    productType: EO:ESA:DAT:SENTINEL-5P
    processingLevel: L1B
    metadata_mapping:
      processingLevel:
        - '{{"processingLevel": "{processingLevel}"}}'
        - '$.id.`sub(/^[^_]([^_]+)_([^_]+)_([^_]+)_.*/, \\3)`'
      processingMode:
        - '{{"processingMode": "{processingMode}"}}'
        - "$.null"
      orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "EO:ESA:DAT:SENTINEL-5P"}}'
  S5P_L2_IR_ALL:
    productType: EO:ESA:DAT:SENTINEL-5P
    processingLevel: L2
    metadata_mapping:
      processingLevel:
        - '{{"processingLevel": "{processingLevel}"}}'
        - '$.id.`sub(/^[^_]([^_]+)_([^_]+)_([^_]+)_.*/, \\3)`'
      processingMode:
        - '{{"processingMode": "{processingMode}"}}'
        - "$.null"
      orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "EO:ESA:DAT:SENTINEL-5P"}}'
  EEA_DAILY_VI:
    productType: EO:EEA:DAT:CLMS_HRVPP_VI
    metadata_mapping:
      id:
        - '{{"uid": "{id}"}}'
        - "$.id"
      <<: *clms_dates
      relativeOrbitNumber:
        - '{{"relativeOrbitNumber": "{relativeOrbitNumber}"}}'
        - "$.null"
      version:
        - '{{"productVersion": "{version}"}}'
        - "$.null"
      platformSerialIdentifier:
        - '{{"platformSerialIdentifier": "{platformSerialIdentifier}"}}'
        - '$.id.`sub(/^[^_]+_[^_]+_([^_]+)_.*/, \\1)`'
      tileIdentifier:
        - '{{"tileId": "{tileIdentifier}"}}'
        - "$.null"
      orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "EO:EEA:DAT:CLMS_HRVPP_VI"}}'
  COP_DEM_GLO30_DGED:
    productType: EO:ESA:DAT:COP-DEM
    providerProductType: DGE_30
    metadata_mapping:
      orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "EO:ESA:DAT:COP-DEM"}}'
  COP_DEM_GLO30_DTED:
    productType: EO:ESA:DAT:COP-DEM
    providerProductType: DTE_30
    metadata_mapping:
      orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "EO:ESA:DAT:COP-DEM"}}'
  COP_DEM_GLO90_DGED:
    productType: EO:ESA:DAT:COP-DEM
    providerProductType: DGE_90
    metadata_mapping:
      orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "EO:ESA:DAT:COP-DEM"}}'
  COP_DEM_GLO90_DTED:
    productType: EO:ESA:DAT:COP-DEM
    providerProductType: DTE_90
    metadata_mapping:
      orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "EO:ESA:DAT:COP-DEM"}}'
  CLMS_GLO_NDVI_333M:
    productType: EO:CLMS:DAT:CLMS_GLOBAL_NDVI_300M_V1_10DAILY_NETCDF
    metadata_mapping:
      <<: *id_from_date
      <<: *clms_dates
      orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "EO:CLMS:DAT:CLMS_GLOBAL_NDVI_300M_V1_10DAILY_NETCDF"}}'
  CLMS_GLO_NDVI_1KM_LTS:
    productType: EO:CLMS:DAT:CLMS_GLOBAL_NDVI_1KM_V2_10DAILY_NETCDF
    metadata_mapping:
      <<: *id_from_date
      <<: *clms_dates
      orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "EO:CLMS:DAT:CLMS_GLOBAL_NDVI_1KM_V2_10DAILY_NETCDF"}}'
  CLMS_CORINE:
    productType: EO:CLMS:DAT:CORINE
    providerProductType: Corine Land Cover 2018
    format: GeoTiff100mt
    metadata_mapping:
      id: "$.id"
      providerProductType:
        - '{{"product_type": "{providerProductType}"}}'
        - "$.null"
      defaultGeometry: "POLYGON((180 -90, 180 90, -180 90, -180 -90, 180 -90))"
      orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "EO:CLMS:DAT:CORINE"}}'
  CLMS_GLO_FCOVER_333M:
    productType: EO:CLMS:DAT:CLMS_GLOBAL_FCOVER_300M_V1_10DAILY_NETCDF
    metadata_mapping:
      <<: *id_from_date
      <<: *clms_dates
      productGroupId:
        - '{{"productGroupId": "{productGroupId}"}}'
        - "$.null"
      orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "EO:CLMS:DAT:CLMS_GLOBAL_FCOVER_300M_V1_10DAILY_NETCDF"}}'
  CLMS_GLO_DMP_333M:
    productType: EO:CLMS:DAT:CLMS_GLOBAL_DMP_300M_V1_10DAILY_NETCDF
    metadata_mapping:
      <<: *id_from_date
      <<: *clms_dates
      productGroupId:
        - '{{"productGroupId": "{productGroupId}"}}'
        - "$.null"
      orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "EO:CLMS:DAT:CLMS_GLOBAL_DMP_300M_V1_10DAILY_NETCDF"}}'
  CLMS_GLO_GDMP_333M:
    productType: EO:CLMS:DAT:CLMS_GLOBAL_GDMP_300M_V1_10DAILY_NETCDF
    metadata_mapping:
      <<: *id_from_date
      <<: *clms_dates
      productGroupId:
        - '{{"productGroupId": "{productGroupId}"}}'
        - "$.null"
      orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "EO:CLMS:DAT:CLMS_GLOBAL_GDMP_300M_V1_10DAILY_NETCDF"}}'
  CLMS_GLO_FAPAR_333M:
    productType: EO:CLMS:DAT:CLMS_GLOBAL_FAPAR_300M_V1_10DAILY_NETCDF
    metadata_mapping:
      <<: *id_from_date
      <<: *clms_dates
      productGroupId:
        - '{{"productGroupId": "{productGroupId}"}}'
        - "$.null"
      orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "EO:CLMS:DAT:CLMS_GLOBAL_FAPAR_300M_V1_10DAILY_NETCDF"}}'
  CLMS_GLO_LAI_333M:
    productType: EO:CLMS:DAT:CLMS_GLOBAL_LAI_300M_V1_10DAILY_NETCDF
    metadata_mapping:
      <<: *id_from_date
      <<: *clms_dates
      productGroupId:
        - '{{"productGroupId": "{productGroupId}"}}'
        - "$.null"
      orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "EO:CLMS:DAT:CLMS_GLOBAL_LAI_300M_V1_10DAILY_NETCDF"}}'
auth: !plugin
  type: TokenAuth
  matching_url: https://[-\w\.]+.wekeo2.eu
  auth_uri: "https://gateway.prod.wekeo2.eu/hda-broker/gettoken"
  refresh_uri: "https://gateway.prod.wekeo2.eu/hda-broker/refreshtoken"
  token_type: json
  token_key: access_token
  refresh_token_key: refresh_token
download: !plugin
  type: HTTPDownload
  base_uri: https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess
  flatten_top_dirs: true
  auth_error_code: 401
  order_enabled: true
  order_method: "POST"
  order_on_response:
    metadata_mapping:
      orderId: "$.json.download_id"
      orderStatusLink: "https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/downloads?download_id={orderId}"
  order_status:
    request:
      method: GET
    metadata_mapping:
      status: $.json.features[0].status
      message: $.json.features[0].message
    error:
      status: Error
    success:
      status: Done
    ordered:
      http_code: 202
    on_success:
      metadata_mapping:
        download_id: $.json.features[0]._id
        downloadLink: https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download/{download_id}
---
!provider # MARK: wekeo_ecmwf
name: wekeo_ecmwf
group: wekeo
priority: 0
roles:
  - host
description: WEkEO - ECMWF data
url: https://www.wekeo.eu/
# anchors to avoid duplications
anchor_time_day_month_year: &time_day_month_year
  startTimeFromAscendingNode:
    - |
      {{
        "year": {startTimeFromAscendingNode#to_datetime_dict(list)}["year"],
        "month": {startTimeFromAscendingNode#to_datetime_dict(list)}["month"],
        "day": {startTimeFromAscendingNode#to_datetime_dict(list)}["day"],
        "time": {startTimeFromAscendingNode#get_ecmwf_time}
      }}
    - $.properties.startdate
  completionTimeFromAscendingNode: $.properties.enddate
anchor_day_month_year: &day_month_year
  startTimeFromAscendingNode:
    - |
      {{
        "year": {startTimeFromAscendingNode#to_datetime_dict(list)}["year"],
        "month": {startTimeFromAscendingNode#to_datetime_dict(list)}["month"],
        "day": {startTimeFromAscendingNode#to_datetime_dict(list)}["day"]
      }}
    - $.properties.startdate
  completionTimeFromAscendingNode: $.properties.enddate
anchor_year_month: &month_year
  startTimeFromAscendingNode:
    - |
      {{
        "year": {startTimeFromAscendingNode#to_datetime_dict(list)}["year"],
        "month": {startTimeFromAscendingNode#to_datetime_dict(list)}["month"]
      }}
    - $.properties.startdate
  completionTimeFromAscendingNode: $.properties.enddate
search: !plugin
  type: WekeoECMWFSearch
  api_endpoint: https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/search
  timeout: 60
  need_auth: true
  auth_error_code: 401
  dates_required: true
  results_entry: "features"
  pagination:
    total_items_nb_key_path: "$.properties.totalResults"
    next_page_query_obj: '{{"itemsPerPage":{items_per_page},"startIndex":{skip}}}'
    max_items_per_page: 200
  discover_product_types:
    fetch_url: null
  available_values_url: "https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/queryable/{productType}"
  metadata_mapping:
    productType:
      - '{{"dataset_id": "{productType}"}}'
      - $.productType
    geometry:
      - '{{"bbox": {geometry#to_bounds}}}'
      - $.geometry
    defaultGeometry: POLYGON((180 -90, 180 90, -180 90, -180 -90, 180 -90))
    id: $.id
    startTimeFromAscendingNode:
      - '{{"startdate": "{startTimeFromAscendingNode#to_iso_utc_datetime}"}}'
      - $.properties.startdate
    completionTimeFromAscendingNode:
      - '{{"enddate": "{completionTimeFromAscendingNode#to_iso_utc_datetime}"}}'
      - $.properties.enddate
    downloadLink: $.properties.location
    title: $.id
    storageStatus: OFFLINE
    orderLink: 'https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download?{{"location": "{downloadLink}","product_id":"{id}", "dataset_id": "{productType}"}}'
products:
  SATELLITE_CARBON_DIOXIDE:
    productType: EO:ECMWF:DAT:SATELLITE_CARBON_DIOXIDE
    ecmwf:processing_level: level_2
    ecmwf:version: "4_5"
    ecmwf:variable: xco2
    ecmwf:sensor_and_algorithm: merged_emma
    metadata_mapping:
      <<: *day_month_year
  SATELLITE_METHANE:
    productType: EO:ECMWF:DAT:SATELLITE_METHANE
    ecmwf:processing_level: level_2
    ecmwf:version: "4_0"
    ecmwf:variable: xch4
    ecmwf:sensor_and_algorithm: sciamachy_wfmd
    metadata_mapping:
      <<: *day_month_year
  SATELLITE_SEA_ICE_EDGE_TYPE:
    productType: EO:ECMWF:DAT:SATELLITE_SEA_ICE_EDGE_TYPE
    ecmwf:variable: sea_ice_type
    ecmwf:region: northern_hemisphere
    ecmwf:cdr_type: cdr
    ecmwf:version: "3_0"
    metadata_mapping:
      <<: *day_month_year
  SATELLITE_SEA_ICE_THICKNESS:
    productType: EO:ECMWF:DAT:SATELLITE_SEA_ICE_THICKNESS
    ecmwf:satellite: envisat
    ecmwf:cdr_type: cdr
    ecmwf:variable: all
    ecmwf:version: "3_0"
    metadata_mapping:
      <<: *month_year
  SATELLITE_SEA_ICE_CONCENTRATION:
    productType: EO:ECMWF:DAT:SATELLITE_SEA_ICE_CONCENTRATION
    ecmwf:cdr_type: cdr
    ecmwf:origin: eumetsat_osi_saf
    ecmwf:region:
      - northern_hemisphere
      - southern_hemisphere
    ecmwf:sensor: ssmis
    ecmwf:temporal_aggregation: daily
    ecmwf:variable: all
    ecmwf:version: v3
    metadata_mapping:
      <<: *day_month_year
  SATELLITE_SEA_LEVEL_GLOBAL:
    productType: EO:ECMWF:DAT:SATELLITE_SEA_LEVEL_GLOBAL
    ecmwf:variable: daily
    ecmwf:version: vdt2021
    metadata_mapping:
      <<: *day_month_year
  SEASONAL_ORIGINAL_SL:
    productType: EO:ECMWF:DAT:SEASONAL_ORIGINAL_SINGLE_LEVELS
    ecmwf:variable: land_sea_mask
    ecmwf:leadtime_hour: 0
    ecmwf:originating_centre: ecmwf
    ecmwf:system: 5
    ecmwf:data_format: grib
    metadata_mapping:
      <<: *day_month_year
  SEASONAL_ORIGINAL_PL:
    productType: EO:ECMWF:DAT:SEASONAL_ORIGINAL_PRESSURE_LEVELS
    ecmwf:variable: geopotential
    ecmwf:pressure_level: 10
    ecmwf:leadtime_hour: 12
    ecmwf:originating_centre: ecmwf
    ecmwf:system: 5
    ecmwf:data_format: grib
    metadata_mapping:
      <<: *day_month_year
  SEASONAL_POSTPROCESSED_SL:
    productType: EO:ECMWF:DAT:SEASONAL_POSTPROCESSED_SINGLE_LEVELS
    ecmwf:product_type: ensemble_mean
    ecmwf:originating_centre: ecmwf
    ecmwf:variable: 2m_dewpoint_temperature_anomaly
    ecmwf:leadtime_month: 1
    ecmwf:origin: ecmwf
    ecmwf:system: 5
    ecmwf:data_format: grib
    metadata_mapping:
      <<: *month_year
  SEASONAL_POSTPROCESSED_PL:
    productType: EO:ECMWF:DAT:SEASONAL_POSTPROCESSED_PRESSURE_LEVELS
    ecmwf:product_type: ensemble_mean
    ecmwf:variable: geopotential_anomaly
    ecmwf:pressure_level: 10
    ecmwf:leadtime_month: 1
    ecmwf:originating_centre: ecmwf
    ecmwf:system: 5
    ecmwf:data_format: grib
    metadata_mapping:
      <<: *month_year
  SEASONAL_MONTHLY_SL:
    productType: EO:ECMWF:DAT:SEASONAL_MONTHLY_SINGLE_LEVELS
    ecmwf:variable: 10m_u_component_of_wind
    ecmwf:product_type: monthly_mean
    ecmwf:leadtime_month: 1
    ecmwf:originating_centre: ecmwf
    ecmwf:system: 5
    ecmwf:data_format: grib
    metadata_mapping:
      <<: *month_year
  SEASONAL_MONTHLY_PL:
    productType: EO:ECMWF:DAT:SEASONAL_MONTHLY_PRESSURE_LEVELS
    ecmwf:variable: geopotential
    ecmwf:product_type: monthly_mean
    ecmwf:leadtime_month: 1
    ecmwf:pressure_level: 10
    ecmwf:originating_centre: ecmwf
    ecmwf:system: 5
    ecmwf:data_format: grib
    metadata_mapping:
      <<: *month_year
  GLACIERS_DIST_RANDOLPH:
    productType: EO:ECMWF:DAT:INSITU_GLACIERS_EXTENT
    ecmwf:variable: glacier_area
    ecmwf:product_type: gridded
    ecmwf:data_format: zip
    ecmwf:version: rgi_6_0
    metadata_mapping:
      <<: *day_month_year
  FIRE_HISTORICAL:
    productType: EO:ECMWF:DAT:CEMS_FIRE_HISTORICAL_V1
    ecmwf:product_type: reanalysis
    ecmwf:variable: fire_weather_index
    ecmwf:system_version: "4_1"
    ecmwf:data_format: grib
    ecmwf:grid: original_grid
    ecmwf:dataset_type: consolidated_dataset
    metadata_mapping:
      <<: *day_month_year
  GRIDDED_GLACIERS_MASS_CHANGE:
    productType: EO:ECMWF:DAT:DERIVED_GRIDDED_GLACIER_MASS_CHANGE
    ecmwf:variable: glacier_mass_change
    ecmwf:data_format: zip
    ecmwf:product_version: wgms_fog_2022_09
    metadata_mapping:
      startTimeFromAscendingNode:
        - |
          {{
            "hydrological_year": {startTimeFromAscendingNode#get_hydrological_year}
          }}
        - $.properties.startdate
      completionTimeFromAscendingNode: $.properties.enddate
  UERRA_EUROPE_SL:
    productType: EO:ECMWF:DAT:REANALYSIS_UERRA_EUROPE_SINGLE_LEVELS
    ecmwf:variable: total_cloud_cover
    ecmwf:origin: uerra_harmonie
    ecmwf:data_format: grib # netcdf format may fail
    metadata_mapping:
      <<: *time_day_month_year
  ERA5_SL:
    productType: EO:ECMWF:DAT:REANALYSIS_ERA5_SINGLE_LEVELS
    ecmwf:product_type: ensemble_mean
    ecmwf:variable: 10m_u_component_of_wind
    ecmwf:download_format: unarchived
    ecmwf:data_format: grib # netcdf format may fail
    metadata_mapping:
      <<: *time_day_month_year
  ERA5_PL:
    productType: EO:ECMWF:DAT:REANALYSIS_ERA5_PRESSURE_LEVELS
    ecmwf:product_type: ensemble_mean
    ecmwf:variable: temperature
    ecmwf:pressure_level: 1
    ecmwf:data_format: grib
    ecmwf:download_format: unarchived
    metadata_mapping:
      <<: *time_day_month_year
  ERA5_SL_MONTHLY:
    productType: EO:ECMWF:DAT:REANALYSIS_ERA5_SINGLE_LEVELS_MONTHLY_MEANS
    ecmwf:product_type: monthly_averaged_ensemble_members
    ecmwf:variable: 10m_u_component_of_wind
    ecmwf:data_format: grib
    ecmwf:download_format: unarchived
    metadata_mapping:
      startTimeFromAscendingNode:
        - |
          {{
            "year": {startTimeFromAscendingNode#to_datetime_dict(list)}["year"],
            "month": {startTimeFromAscendingNode#to_datetime_dict(list)}["month"],
            "time": {startTimeFromAscendingNode#get_ecmwf_time}
          }}
        - $.properties.startdate
      completionTimeFromAscendingNode: $.properties.enddate
  ERA5_PL_MONTHLY:
    productType: EO:ECMWF:DAT:REANALYSIS_ERA5_PRESSURE_LEVELS_MONTHLY_MEANS
    ecmwf:product_type: monthly_averaged_ensemble_members
    ecmwf:variable: divergence
    ecmwf:pressure_level: 1
    ecmwf:data_format: grib
    ecmwf:download_format: unarchived
    metadata_mapping:
      startTimeFromAscendingNode:
        - |
          {{
            "year": {startTimeFromAscendingNode#to_datetime_dict(list)}["year"],
            "month": {startTimeFromAscendingNode#to_datetime_dict(list)}["month"],
            "time": {startTimeFromAscendingNode#get_ecmwf_time}
          }}
        - $.properties.startdate
      completionTimeFromAscendingNode: $.properties.enddate
  ERA5_LAND:
    productType: EO:ECMWF:DAT:REANALYSIS_ERA5_LAND
    ecmwf:variable: 2m_dewpoint_temperature
    ecmwf:data_format: grib
    ecmwf:download_format: unarchived
    metadata_mapping:
      <<: *time_day_month_year
  ERA5_LAND_MONTHLY:
    productType: EO:ECMWF:DAT:REANALYSIS_ERA5_LAND_MONTHLY_MEANS
    ecmwf:product_type: monthly_averaged_reanalysis
    ecmwf:variable: 2m_dewpoint_temperature
    ecmwf:data_format: grib
    ecmwf:download_format: unarchived
    metadata_mapping:
      startTimeFromAscendingNode:
        - |
          {{
            "year": {startTimeFromAscendingNode#to_datetime_dict(list)}["year"],
            "month": {startTimeFromAscendingNode#to_datetime_dict(list)}["month"],
            "time": {startTimeFromAscendingNode#get_ecmwf_time}
          }}
        - $.properties.startdate
      completionTimeFromAscendingNode: $.properties.enddate
  CAMS_EAC4:
    productType: EO:ECMWF:DAT:CAMS_GLOBAL_REANALYSIS_EAC4
    ecmwf:data_format: grib
    ecmwf:variable: 2m_dewpoint_temperature
    ecmwf:time: 00:00
  CAMS_GLOBAL_EMISSIONS:
    productType: EO:ECMWF:DAT:CAMS_GLOBAL_EMISSION_INVENTORIES
    ecmwf:version: latest
    ecmwf:data_format: zip
    ecmwf:variable: acids
    ecmwf:source: anthropogenic
    metadata_mapping:
      startTimeFromAscendingNode:
        - |
          {{
            "year": {startTimeFromAscendingNode#to_datetime_dict(list)}["year"]
          }}
        - $.properties.startdate
      completionTimeFromAscendingNode: $.properties.enddate
  CAMS_EAC4_MONTHLY:
    productType: EO:ECMWF:DAT:CAMS_GLOBAL_REANALYSIS_EAC4_MONTHLY
    ecmwf:data_format: grib
    ecmwf:variable: 2m_dewpoint_temperature
    ecmwf:product_type: monthly_mean
    metadata_mapping:
      <<: *month_year
  CAMS_GREENHOUSE_INVERSION:
    productType: EO:ECMWF:DAT:CAMS_GLOBAL_GREENHOUSE_GAS_INVERSION
    ecmwf:version: latest
    ecmwf:variable: carbon_dioxide
    ecmwf:quantity: mean_column
    ecmwf:input_observations: surface
    ecmwf:time_aggregation: instantaneous
    metadata_mapping:
      <<: *month_year
  CAMS_EU_AIR_QUALITY_RE:
    productType: EO:ECMWF:DAT:CAMS_EUROPE_AIR_QUALITY_REANALYSES
    ecmwf:type: validated_reanalysis
    ecmwf:data_format: zip
    ecmwf:variable: nitrogen_dioxide
    ecmwf:model: ensemble
    ecmwf:level: 0
    metadata_mapping:
      <<: *month_year
  CAMS_GRF:
    productType: EO:ECMWF:DAT:CAMS_GLOBAL_RADIATIVE_FORCINGS
    ecmwf:data_format: zip
    ecmwf:variable: radiative_forcing_of_carbon_dioxide
    ecmwf:forcing_type: instantaneous
    ecmwf:band: long_wave
    ecmwf:sky_type: all_sky
    ecmwf:level: surface
    ecmwf:version: 2
    metadata_mapping:
      <<: *month_year
  CAMS_GRF_AUX:
    productType: EO:ECMWF:DAT:CAMS_GLOBAL_RADIATIVE_FORCING_AUXILLIARY_VARIABLES
    ecmwf:band: short_wave
    ecmwf:sky_type: clear_sky
    ecmwf:version: 1.5
    ecmwf:data_format: zip
    ecmwf:variable: aerosol_radiation_effect
    ecmwf:aerosol_type: marine
    ecmwf:level: surface
    metadata_mapping:
      <<: *month_year
  CAMS_GREENHOUSE_EGG4:
    productType: EO:ECMWF:DAT:CAMS_GLOBAL_GHG_REANALYSIS_EGG4
    ecmwf:data_format: grib
    ecmwf:variable: snow_albedo
    ecmwf:step: 0
  CAMS_GREENHOUSE_EGG4_MONTHLY:
    productType: EO:ECMWF:DAT:CAMS_GLOBAL_GHG_REANALYSIS_EGG4_MONTHLY
    ecmwf:data_format: grib
    ecmwf:variable: snow_albedo
    ecmwf:product_type: monthly_mean_by_hour_of_day
    ecmwf:step: 3
    ecmwf:time: 00:00
    metadata_mapping:
      <<: *month_year
  CAMS_EU_AIR_QUALITY_FORECAST:
    productType: EO:ECMWF:DAT:CAMS_EUROPE_AIR_QUALITY_FORECASTS
    ecmwf:model: ensemble
    ecmwf:data_format: grib
    ecmwf:variable: alder_pollen
    ecmwf:type: forecast
    ecmwf:time: 00:00
    ecmwf:level: 0
    ecmwf:leadtime_hour: 0
  CAMS_GAC_FORECAST:
    productType: EO:ECMWF:DAT:CAMS_GLOBAL_ATMOSPHERIC_COMPOSITION_FORECASTS
    ecmwf:type: forecast
    ecmwf:data_format: grib
    ecmwf:variable: 10m_u_component_of_wind
    ecmwf:time: 00:00
    ecmwf:leadtime_hour: 0
  CAMS_GFE_GFAS:
    productType: EO:ECMWF:DAT:CAMS_GLOBAL_FIRE_EMISSIONS_GFAS
    ecmwf:data_format: grib
    ecmwf:variable: wildfire_combustion_rate
    ecmwf:time: 00:00
    ecmwf:leadtime_hour: 0
  CAMS_SOLAR_RADIATION:
    productType: EO:ECMWF:DAT:CAMS_SOLAR_RADIATION_TIMESERIES
    ecmwf:sky_type: clear
    ecmwf:time_step: 1minute
    ecmwf:time_reference: true_solar_time
    ecmwf:altitude: -999
    ecmwf:format: csv
    geometry: POLYGON((180 -90, 180 90, -180 90, -180 -90, 180 -90))
    metadata_mapping:
      geometry:
        - '{{"longitude": {geometry#to_longitude_latitude}["lon"], "latitude": {geometry#to_longitude_latitude}["lat"]}}'
        - "$.null"
auth: !plugin
  type: TokenAuth
  matching_url: https://[-\w\.]+.wekeo2.eu
  auth_uri: "https://gateway.prod.wekeo2.eu/hda-broker/gettoken"
  refresh_uri: "https://gateway.prod.wekeo2.eu/hda-broker/refreshtoken"
  token_type: json
  token_key: access_token
  refresh_token_key: refresh_token
download: !plugin
  type: HTTPDownload
  auth_error_code: 401
  order_enabled: true
  order_method: "POST"
  order_on_response:
    metadata_mapping:
      orderId: "$.json.download_id"
      orderStatusLink: "https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/downloads?download_id={orderId}"
  order_status:
    request:
      method: GET
    metadata_mapping:
      status: $.json.features[0].status
      message: $.json.features[0].message
    error:
      status: Error
    success:
      status: Done
    ordered:
      http_code: 202
    on_success:
      metadata_mapping:
        download_id: $.json.features[0]._id
        downloadLink: https://gateway.prod.wekeo2.eu/hda-broker/api/v1/dataaccess/download/{download_id}
  products:
    FIRE_HISTORICAL:
      output_extension: .grib
